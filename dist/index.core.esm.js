var G=class{constructor(e){this.data={};this.triggers={};this.ctr=0;this.setState=e=>{Object.assign(this.data,e);let t=Object.getOwnPropertyNames(e);for(let n of t)this.triggerEvent(n,this.data[n]);if(this.triggers[O]){let n=_=>{_(e)},s=this.triggers[O].length;for(let _=s-1;_>=0;_--)n(this.triggers[O][_].onchange)}return this.data};this.setValue=(e,t)=>{this.data[e]=t,this.triggerEvent(e,t)};this.triggerEvent=(e,t)=>{if(this.triggers[e]){let n=_=>{_.onchange(t)},s=this.triggers[e].length;for(let _=s-1;_>=0;_--)n(this.triggers[e][_])}};this.subscribeState=e=>this.subscribeEvent(O,e);this.unsubscribeState=e=>this.unsubscribeEvent(O,e);this.subscribeEvent=(e,t,n,s)=>{if(e){n&&s&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>n[s],set:r=>{n[s]=r},enumerable:!0,configurable:!0}),this.triggers[e]||(this.triggers[e]=[]);let _=this.ctr;return this.ctr++,this.triggers[e].push({sub:_,onchange:t}),_}else return};this.unsubscribeEvent=(e,t)=>{let n=this.triggers[e];if(n)if(t===void 0)delete this.triggers[e],delete this.data[e];else{let s,_=n.find((r,a)=>{if(r.sub===t)return s=a,!0});return _&&n.splice(s,1),Object.keys(n).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(_),!0}};this.subscribeEventOnce=(e,t)=>{let n,s=_=>{t(_),this.unsubscribeEvent(e,n)};return n=this.subscribeEvent(e,s),n};this.getEvent=(e,t)=>{for(let n in this.triggers[e])if(this.triggers[e][n].sub===t)return this.triggers[e][n]};this.getSnapshot=()=>{let e={};for(let t in this.data)e[t]=this.data[t]};typeof e=="object"&&(this.data=e)}},O="*s";var P=new G,g=class{constructor(e,t,n){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:P};this.__setProperties=(e,t,n)=>{if((()=>{let _=e;typeof e=="function"?j(e)?e=new e:e={__operator:e,__node:{forward:!0,tag:e.name}}:typeof e=="string"&&n?.get(e)&&(e=n.get(e)),"__node"in e||(e.__node={}),e.__node.initial||(e.__node.initial=_)})(),typeof e=="object"){let _=()=>{e.__node?.state?this.__node.state=e.__node.state:n&&(e.__node.state=n.__node.state)},r=()=>{e.__props&&(typeof e.__props=="function"&&(e.__props=new e.__props),typeof e.__props=="object"&&this.__proxyObject(e.__props))},a=()=>{e.__node.tag||(e.__operator?.name?e.__node.tag=e.__operator.name:e.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},o=()=>{typeof e.__node=="string"?n?.get(e.__node.tag)?e=n.get(e.__node.tag):e.__node={}:e.__node||(e.__node={}),n&&(e.__node.graph=n),e instanceof b&&(e.__node.source=e)},d=()=>{if(!e.__parent&&t&&(e.__parent=t),t?.__node&&!(t instanceof b||e instanceof b)&&(e.__node.tag=t.__node.tag+"."+e.__node.tag),t instanceof b&&e instanceof b&&(e.__node.loaders&&Object.assign(t.__node.loaders?t.__node.loaders:{},e.__node.loaders),t.__node.mapGraphs)){e.__node.nodes.forEach(h=>{t.set(e.__node.tag+"."+h.__node.tag,h)});let u=()=>{e.__node.nodes.forEach(h=>{t.__node.nodes.delete(e.__node.tag+"."+h.__node.tag)})};this.__addOndisconnected(u)}},f=()=>{if(typeof e.default=="function"&&!e.__operator&&(e.__operator=e.default),e.__operator){if(typeof e.__operator=="string"&&n){let u=n.get(e.__operator);u&&(e.__operator=u.__operator),!e.__node.tag&&e.__operator.name&&(e.__node.tag=e.__operator.name)}typeof e.__operator=="function"&&(e.__operator=this.__setOperator(e.__operator)),e.default&&(e.default=e.__operator)}},l=()=>{e.__node=Object.assign(this.__node,e.__node);let u=Object.getOwnPropertyNames(e).filter(h=>{if(!w[h])return!0});for(let h of u)h in e&&(this[h]=e[h])},c=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(u=>u.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(u=>u.bind(this))))};_(),a(),r(),o(),d(),l(),c(),f()}};this.__subscribe=(e,t,n,s,_,r)=>{let a=(d,f=(c,u)=>u||c,l=e)=>{let c;if(r){let p=x(l,r,this.__node.graph);l=p.__callback,c=p.__args}let u=this.__node.state.subscribeEvent(d,l,this,t),h=this.__node.state.getEvent(d,u);return this.__listeners||(this.__listeners={}),this.__listeners[d]=this.__node.state.triggers[d],h&&(h.source=this.__node.tag,t&&(h.key=t),h.target=f(e,s),n&&(h.subInput=n),r&&(h.arguments=r,h.__args=c),_&&(h.tkey=_),h.node=this,h.graph=this.__node.graph),u},o=d=>{let f=this.__node.graph.get(d);if(!f&&d.includes(".")){s=d.substring(0,d.lastIndexOf("."));let l=this.__node.graph.get(d.substring(0,s));_=d.lastIndexOf(".")+1,l&&typeof l[t]=="function"&&(d=(...c)=>l[_](...c))}else f.__operator&&(d=f.__operator,_="__operator")};if(t){if((!this.__node.localState||!this.__node.localState[t])&&this.__addLocalState(this,t),typeof e=="string"){if(_=e,s){if(this.__node.graph?.get(s)){let l=this.__node.graph?.get(s);if(typeof l[e]=="function"){let c=l[e];e=(...u)=>{c(...u)}}else{let c=e;e=h=>{l[c]=h}}}}else if(typeof this[e]=="function"){let l=this[e];e=(...c)=>{l(...c)}}else this.__node.graph?.get(e)&&o(e);if(typeof e!="function")return}let d,f=n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t;return typeof e=="function"?d=a(f,(l,c)=>c||l,e):e?.__node&&(d=a(f,(l,c)=>c||l.__node.unique,(...l)=>{e.__operator&&e.__operator(...l)})),d}else{if(typeof e=="string"&&(this.__node.graph.get(e)&&(e=this.__node.graph.get(e)),_="__operator",typeof e!="object"))return;let d,f=n?this.__node.unique+"input":this.__node.unique;return typeof e=="function"?d=a(f,(l,c)=>c||l,e):e?.__node&&(d=a(f,(l,c)=>c||l.__node.unique,(...l)=>{e.__operator&&e.__operator(...l)})),d}};this.__unsubscribe=(e,t,n)=>t?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t,e):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,e);this.__setOperator=e=>{e=e.bind(this),this.__args&&this.__node.graph&&(e=x(e,this.__args,this.__node.graph).__callback);let t=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[t]&&this.__node.state.setValue(t,n);let s=e(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof s?.then=="function"?s.then(_=>{_!==void 0&&this.__node.state.setValue(this.__node.unique,_)}).catch(console.error):s!==void 0&&this.__node.state.setValue(this.__node.unique,s)),s},this.__parent instanceof g&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),s=()=>{this.__parent?.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(s),this.__subscribedToParent=!0}return this.__operator};this.__addLocalState=(e,t)=>{if(!e)return;this.__node.localState||(this.__node.localState={});let n=this.__node.localState,s=(_,r)=>{let a=this.__node.unique+"."+r,o=`${a}input`,d,f,l,c;if(typeof _[r]=="function"&&r!=="__operator")this.__props?.[r]?l=this.__props:l=n,d=()=>l[r],f=u=>{this.__props?.[r]||(u=u.bind(this)),l[r]=(...h)=>{this.__node.state.triggers[o]&&this.__node.state.setValue(o,h);let p=u(...h);return this.__node.state.triggers[a]&&(typeof p?.then=="function"?p.then(y=>{this.__node.state.triggerEvent(a,y)}).catch(console.error):this.__node.state.triggerEvent(a,p)),p}},n[r]=_[r].bind(this),c={get:d,set:f,enumerable:!0,configurable:!0};else{let u,h,p;this.__props?.[r]?p=this.__props:p=n,u=()=>p[r],h=y=>{p[r]=y,this.__node.state.triggers[a]&&this.__node.state.triggerEvent(a,y)},n[r]=_[r],c={get:u,set:h,enumerable:!0,configurable:!0}}if(Object.defineProperty(_,r,c),typeof this.__node.initial=="object"){let u=Object.getOwnPropertyDescriptor(this.__node.initial,r);(u===void 0||u?.configurable)&&Object.defineProperty(this.__node.initial,r,c)}};if(t)s(e,t);else for(let _ in e)s(e,_)};this.__proxyObject=e=>{let t=S(e);for(let n of t){let s={get:()=>e[n],set:_=>{e[n]=_},enumerable:!0,configurable:!0};if(Object.defineProperty(this,n,s),typeof this.__node.initial=="object"){let _=Object.getOwnPropertyDescriptor(this.__node.initial,n);(_===void 0||_?.configurable)&&Object.defineProperty(this.__node.initial,n,s)}}};this.__setProperties(e,t,n)}__addOnconnected(e){e=e.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){e=e.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=n=>{n(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=n=>{n(this)};this.__ondisconnected.forEach(t)}}},b=class{constructor(e){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:P,roots:{}};this.init=e=>{if(e){let t=Object.assign({},e);delete t.roots,m(this.__node,t),e.roots&&this.load(e.roots)}};this.load=e=>{function t(_,r,a=!0,o=!0){if(o&&(_?Object.assign(_,r):_=Object.assign({},r),t(_,r,!0,!1)),r?.__children&&!a)r.__children?.constructor.name==="Object"?_.__children?.constructor.name==="Object"?t(_.__children,r.__children,!0,!1):_.__children=t({},r.__children,!0,!1):_.__children=r.__children;else if(a)for(let d in r)_[d]=Object.assign({},r[d]),r[d]?.__children&&t({},r[d].__children,!1,!1);return _}this.__node.roots=t(this.__node.roots?this.__node.roots:{},e);let n=Object.assign({},e);n.__node&&delete n.__node;let s=this.recursiveSet(n,this,void 0,e);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let _=new g(e,this,this);this.set(_.__node.tag,_),this.runLoaders(_,this,e,e.__node.tag),_.__listeners&&(s[_.__node.tag]=_.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(s),n};this.setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders);this.runLoaders=(e,t,n,s)=>{for(let _ in this.__node.loaders)typeof this.__node.loaders[_]=="object"?(this.__node.loaders[_].init&&this.__node.loaders[_](e,t,this,this.__node.roots,n,s),this.__node.loaders[_].connected&&e.__addOnconnected(this.__node.loaders[_].connect),this.__node.loaders[_].disconnected&&e.__addOndisconnected(this.__node.loaders[_].disconnect)):typeof this.__node.loaders[_]=="function"&&this.__node.loaders[_](e,t,this,this.__node.roots,n,s)};this.add=(e,t)=>{let n={};typeof t=="string"&&(t=this.get(t));let s;if(typeof e=="function"?j(e)?e.prototype instanceof g?(e=e.prototype.constructor(e,t,this),s=!0):e=new e:e={__operator:e}:typeof e=="string"&&(e=this.__node.roots[e]),!!e){if(!s){let _=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(Object.getPrototypeOf(e));_.push(...r),_=_.filter(o=>!w.includes(o));let a={};for(let o of _)a[o]=e[o];e=a}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&!this.get(e.__node.tag)){let _,r=m({},e,2);if(s?_=e:_=new g(e,t,this),this.set(_.__node.tag,_),this.runLoaders(_,t,e,_.__node.tag),this.__node.roots[_.__node.tag]=r,_.__children&&(_.__children=Object.assign({},_.__children),this.recursiveSet(_.__children,_,n,_.__children)),_.__listeners){n[_.__node.tag]=Object.assign({},_.__listeners);for(let a in _.__listeners){let o=_.__listeners[a];_[a]&&(delete n[_.__node.tag][a],n[_.__node.tag][_.__node.tag+"."+a]=o),typeof o=="string"&&(_.__children?.[o]?n[_.__node.tag][a]=_.__node.tag+"."+o:t instanceof g&&(t.__node.tag===o||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===o)&&(n[_.__node.tag][a]=t.__node.tag))}}return this.setListeners(n),_.__callConnected(),_}else if(e.__node.tag)return this.get(e.__node.tag)}};this.recursiveSet=(e,t,n={},s)=>{let _=Object.getOwnPropertyNames(s),r=Object.getOwnPropertyNames(Object.getPrototypeOf(s)).filter(a=>!w.includes(a));_.push(...r);for(let a of _){if(a.includes("__"))continue;let o=s[a];if(Array.isArray(o))continue;let d;if(typeof o=="function"?j(o)?(o=new o,o instanceof g&&(o=o.prototype.constructor(o,t,this),d=!0)):o={__operator:o}:typeof o=="string"?this.__node.nodes.get(o)?o=this.__node.nodes.get(o):o=this.__node.roots[o]:typeof o=="boolean"&&(this.__node.nodes.get(a)?o=this.__node.nodes.get(a):o=this.__node.roots[a]),o instanceof Object){if(!d&&!(o instanceof g)){let u=Object.getOwnPropertyNames(o),h=Object.getOwnPropertyNames(Object.getPrototypeOf(o));h.splice(h.indexOf("constructor"),1),u.push(...h);let p={};for(let y of u)p[y]=o[y];o=p}if(o.__node||(o.__node={}),o.__node.tag||(o.__node.tag=a),o.__node.initial||(o.__node.initial=e[a]),this.get(o.__node.tag)&&!(!(t instanceof b)&&t?.__node)||t?.__node&&this.get(t.__node.tag+"."+o.__node.tag))continue;let f,l=!1,c=m({},o,2);if(d||o instanceof g?f=o:(f=new g(o,t,this),l=!0),!l&&o instanceof g&&!d&&t instanceof g){let u=this.subscribe(t.__node.tag,f.__node.tag),h=p=>{this.unsubscribe(t.__node.tag,u)};f.__addOndisconnected(h)}else if(f){if(this.set(f.__node.tag,f),this.runLoaders(f,t,e[a],a),e[a]=f,this.__node.roots[f.__node.tag]=c,f.__children&&(f.__children=Object.assign({},f.__children),this.recursiveSet(f.__children,f,n,f.__children)),f.__listeners){n[f.__node.tag]=Object.assign({},f.__listeners);for(let u in f.__listeners){let h=f.__listeners[u],p=u;f[u]&&(delete n[f.__node.tag][u],p=f.__node.tag+"."+u,n[f.__node.tag][p]=h),typeof h=="string"&&(f.__children?.[h]?n[f.__node.tag][p]=f.__node.tag+"."+h:t instanceof g&&(t.__node.tag===h||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===h)&&(n[f.__node.tag][p]=t.__node.tag))}}f.__callConnected()}}}return n};this.remove=(e,t=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof g){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let n=s=>{for(let _ in s)this.unsubscribe(s[_]),this.delete(s[_].__node.tag),delete this.__node.roots[s[_].__node.tag],this.delete(_),delete this.__node.roots[_],s[_].__node.tag=s[_].__node.tag.substring(s[_].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(s[_]),s[_].__callDisconnected(),s[_].__children&&n(s[_].__children)};e.__children&&n(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e?.__node.graph&&(e.__node.graph=void 0),e};this.run=(e,...t)=>{if(typeof e=="string"){let n=this.get(e);if(!n&&e.includes(".")){if(n=this.get(e.substring(0,e.lastIndexOf("."))),typeof n?.[e.substring(e.lastIndexOf(".")+1)]=="function")return n[e.substring(e.lastIndexOf(".")+1)](...t)}else if(n?.__operator)return n.__operator(...t)}if(e?.__operator)return e?.__operator(...t)};this.setListeners=e=>{for(let t in e){let n=this.get(t);if(typeof e[t]=="object")for(let s in e[t]){let _=this.get(s),r;if(typeof e[t][s]!="object")e[t][s]={__callback:e[t][s]};else if(!e[t][s].__callback)for(let a in e[t][s]){typeof e[t][s][a]!="object"&&(e[t][s][a]={__callback:e[t][s][a]},n.__operator&&(e[t][s][a].__callback===!0||typeof e[t][s][a].__callback>"u")&&(e[t][s][a].__callback=n.__operator));let o=this.get(a);if(o)r=this.subscribe(o,e[t][s][a].__callback,e[t][s].__args,void 0,e[t][s].inputState,t,s);else{let d=s.substring(0,s.lastIndexOf("."));if(o=this.get(d),o){let f=s.substring(s.lastIndexOf(".")+1);r=this.subscribe(o,e[t][s][a].__callback,e[t][s][a].__args,f,e[t][s][a].inputState,t,s)}}}if("__callback"in e[t][s])if(n&&((e[t][s].__callback===!0||typeof e[t][s].__callback>"u")&&(e[t][s].__callback=n.__operator),typeof e[t][s].__callback=="function"&&(e[t][s].__callback=e[t][s].__callback.bind(n))),_)r=this.subscribe(_,e[t][s].__callback,e[t][s].__args,void 0,e[t][s].inputState,t,s);else{let a=s.substring(0,s.lastIndexOf("."));_=this.get(a),_&&(r=this.subscribe(_,e[t][s].__callback,e[t][s].__args,s.substring(s.lastIndexOf(".")+1),e[t][s].inputState,t,s))}}}};this.clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let n in e.__listeners){if(t&&n!==t||typeof e.__listeners[n]?.sub!="number")continue;let s=this.get(n);if(s)if(typeof!e.__listeners[n]?.__callback=="number")for(let _ in e.__listeners[n])e.__listeners[n][_]?.sub&&(this.unsubscribe(s,e.__listeners[n][_].sub,void 0,e.__listeners[n][_].inputState),e.__listeners[n][_].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n].sub,void 0,e.__listeners[n].inputState),e.__listeners[n].sub=void 0);else if(s=this.get(n.substring(0,n.lastIndexOf("."))),s)if(typeof e.__listeners[n]=="object"&&!e.__listeners[n]?.__callback)for(let _ in e.__listeners[n])typeof e.__listeners[n][_]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n][_].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n][_].inputState),e.__listeners[n][_].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n].inputState),e.__listeners[n].sub=void 0)}};this.get=e=>this.__node.nodes.get(e);this.set=(e,t)=>this.__node.nodes.set(e,t);this.delete=e=>this.__node.nodes.delete(e);this.getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof g){let n;if(t)n=Object.assign({},this.__node.roots[e.__node.tag]);else{n=Object.assign({},e);for(let s in n)s.includes("__")&&delete n[s]}}};this.subscribe=(e,t,n,s,_,r,a,o)=>{let d=e;if(typeof e=="string"&&(d=this.get(e),!d&&e.includes(".")&&(d=this.get(e.substring(0,e.lastIndexOf("."))),s=e.substring(e.lastIndexOf(".")+1))),r instanceof g&&(r=r.__node.tag),typeof t=="string"){let l=c=>{if(this.get(c)?.__operator){let u=this.get(c);r=c,c=function(...h){return u.__operator(...h)}}else if(c.includes(".")){r=c.substring(0,c.lastIndexOf("."));let u=this.get(r),h=c.substring(c.lastIndexOf(".")+1);o=h,typeof u[h]=="function"?u[h]instanceof g?c=u[h]:c=function(...p){return u[h](...p)}:c=function(p){return u[h]=p,u[h]}}return c};if(r){let c=this.get(r);typeof c?.[t]=="function"?(o=t,t=function(...u){return c[s](...u)}):c[s]?(o=s,c[s]instanceof g?t=c[s]:t=function(u){return c[s]=u,c[s]}):t=l(t)}else t=l(t)}let f;if(d instanceof g){let l=()=>{f=d.__subscribe(t,s,_,r,o,n);let c=()=>{f!==void 0&&d.__unsubscribe(f,s,_),f=void 0};d.__addOndisconnected(()=>{c(),d.__addOnconnected(()=>{f===void 0&&d.__node.graph.__node.tag===this.__node.tag&&l()})}),typeof t=="string"&&this.get(t)&&(t=this.get(t)),t instanceof g&&t.__addOndisconnected(()=>{c()})};l()}else if(typeof e=="string"){let l=this.get(e);if(l){if(t instanceof g&&t.__operator){let c=()=>{f=l.__subscribe(t.__operator,s,_,r,o,n);let u=()=>{f!==void 0&&l.__unsubscribe(f,s,_)};l.__addOndisconnected(()=>{u(),l.__addOnconnected(()=>{f===void 0&&l.__node.graph.__node.tag===this.__node.tag&&c()})}),t.__addOndisconnected(u)};c()}else if(typeof t=="function"||typeof t=="string"){let c=()=>{f=l.__subscribe(t,s,_,r,o,n);let u=()=>{f!==void 0&&l.__unsubscribe(f,s,_),f=void 0};l.__addOndisconnected(()=>{u(),l.__addOnconnected(()=>{f===void 0&&l.__node.graph.__node.tag===this.__node.tag&&c()})}),typeof t=="string"&&this.get(t)&&this.get(t).__addOndisconnected(u)};c()}}else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&(f=this.__node.state.subscribeEvent(e,t))}return f};this.unsubscribe=(e,t,n,s)=>e instanceof g?e.__unsubscribe(t,n,s):this.get(e)?.__unsubscribe(t,n,s);this.setState=e=>{this.__node.state.setState(e)};this.init(e)}};function m(i,e,t=1/0,n=0){for(let s in e)e[s]?.constructor.name==="Object"&&n<t?(n++,i[s]?.constructor.name==="Object"?m(i[s],e[s],t,n):i[s]=m({},e[s],t,n)):i[s]=e[s];return i}function S(i){var e=[],t=i;do{var n=Object.getOwnPropertyNames(t);let s=function(_){e.indexOf(_)===-1&&e.push(_)};n.forEach(s)}while(t=Object.getPrototypeOf(t));return e}function V(i){let e=S(i),t={};for(let n of e)t[n]=i[n];return t}function j(i){return A(i)==="class"}function A(i){return typeof i=="function"?i.prototype?Object.getOwnPropertyDescriptor(i,"prototype")?.writable?"function":"class":i.constructor.name==="AsyncFunction"?"async":"arrow":""}var N=(i,e)=>{if(e.get(i)?.__operator){let t=e.get(i);return(...n)=>{t.__operator(...n)}}else if(i.includes(".")){let t=i.split("."),n=t.pop(),s=t.join("."),_=e.get(s);return typeof e.get(s)?.[n]=="function"?(...r)=>_[n](...r):()=>_[n]}else if(e.get(i)){let t=e.get(i);return()=>t}else{let t=i;return()=>t}},x=(i,e,t)=>{let n=[],s=(r,a)=>{if(r==="__output"||r==="__input"||r==="__callback")n[a]={__callback:o=>o,__args:void 0,idx:a};else if(typeof r=="string")n[a]={__callback:N(r,t),__args:void 0,idx:a};else if(typeof r=="function"){let o=r;n[a]={__callback:(...d)=>o(...d),__args:void 0,idx:a}}else if(typeof r=="object"&&(r.__input||r.__callback)){let o=function(d){let f=d.__input?d.__input:d.__callback;if(typeof d.__input=="string"&&(f={__callback:N(d.__input,t),__args:void 0,idx:a}),d.__args){let l=x(f,d.__args,t);f={__callback:l.__callback,__args:l.__args,idx:a}}else f={__callback:f,__args:void 0,idx:a};if(d.__output){let l=d.__output;if(typeof d.__output=="string"?l={__callback:N(l,t),__args:void 0,idx:a}:typeof r.__output=="object"&&(l=o(l)),typeof l?.__callback=="function"){let c=f.__callback,u=l.__callback;f={__callback:(...h)=>u(c(...h)),__args:l.__args,idx:a}}}return f};n[a]=o(r)}else{let o=r;n[a]={__callback:()=>o,__args:void 0,idx:a}}};e.forEach(s),typeof i=="string"&&(i={__callback:N(i,t),__args:void 0});let _=typeof i=="function"?i:i.__callback;return i=function(...r){let a=d=>d.__callback(...r);return _(...n.map(a))},{__callback:i,__args:n}},w=Object.getOwnPropertyNames(Object.getPrototypeOf({}));var F=(i,e,t)=>{i.__node.backward&&e instanceof g&&t.setListeners({[e.__node.tag]:{[i.__node.tag]:e}})},q=(i,e,t)=>{if(i.__operator&&!i.__node.looperSet){if(typeof i.__node.delay=="number"){let n=i.__operator;i.__setOperator((...s)=>new Promise((_,r)=>{setTimeout(async()=>{_(await n(...s))},i.__node.delay)}))}else if(i.__node.frame===!0){let n=i.__operator;i.__setOperator((...s)=>new Promise((_,r)=>{requestAnimationFrame(async()=>{_(await n(...s))})}))}if(typeof i.__node.repeat=="number"||typeof i.__node.recursive=="number"){let n=i.__operator;i.__setOperator(async(...s)=>{let _=i.__node.repeat?i.__node.repeat:i.__node.recursive,r,a=async(o,...d)=>{for(;o>0;){if(i.__node.delay||i.__node.frame){n(...d).then(async f=>{i.__node.recursive?await a(o,f):await a(o,...d)});break}else r=await n(...s);o--}};return await a(_,...s),r})}if(i.__node.loop&&typeof i.__node.loop=="number"){i.__node.looperSet=!0;let n=i.__operator,s=i.__node.loop;i.__setOperator((...r)=>{if("looping"in i.__node||(i.__node.looping=!0),i.__node.looping){let a=performance.now();n(...r),setTimeout(()=>{let d=performance.now()-a-i.__node.loop;d>0?s=i.__node.loop-d:s=i.__node.loop,s<=0&&(s=i.__node.loop),i.__operator(...r)},s)}}),i.__node.looping&&i.__operator();let _=r=>{r.__node.looping&&(r.__node.looping=!1)};i.__addOndisconnected(_)}}},L=(i,e,t)=>{if(i.__node.animate===!0||i.__animation){let n=i.__operator;i.__setOperator((..._)=>{"animating"in i.__node||(i.__node.animating=!0),i.__node.animating&&(typeof i.__animation=="function"?i.__animation(..._):n(..._),requestAnimationFrame(()=>{i.__operator(..._)}))}),(i.__node.animating||(!("animating"in i.__node)||i.__node.animating)&&i.__animation)&&setTimeout(()=>{requestAnimationFrame(i.__operator)},10);let s=_=>{_.__node.animating&&(_.__node.animating=!1)};i.__addOndisconnected(s)}},v=(i,e,t)=>{if(typeof i.__branch=="object"&&i.__operator&&!i.__branchApplied){let n=i.__operator;i.__branchApplied=!0,i.__operator=(...s)=>{let _=n(...s);for(let r in i.__branch){let a=()=>{typeof i.__branch[r].then=="function"?i.__branch[r].then(_):i.__branch[r].then instanceof g&&i.__branch[r].then.__operator?i.__branch[r].then.__operator(_):_=i.__branch[r].then};typeof i.__branch[r].if=="function"?i.__branch[r].if(_)==!0&&a():i.__branch[r].if===_&&a()}return _}}if(i.__listeners){for(let n in i.__listeners)if(typeof i.__listeners[n]=="object"&&i.__listeners[n].branch&&!i.__listeners[n].branchApplied){let s=i.__listeners[n].callback;i.__listeners[n].branchApplied=!0,i.__listeners.callback=_=>{let r=()=>{typeof i.__listeners[n].branch.then=="function"?_=i.__listeners[n].branch.then(_):i.__listeners[n].branch.then instanceof g&&i.__listeners[n].branch.then.__operator?_=i.__listeners[n].branch.then.__operator(_):_=i.__listeners[n].branch.then};return typeof i.__listeners[n].branch.if=="function"?i.__listeners[n].branch.if(_)&&r():i.__listeners[n].branch.if===_&&r(),s(_)}}}},M=(i,e,t)=>{if(i.__listeners)for(let n in i.__listeners)typeof i.__listeners[n]=="object"&&i.__listeners[n].oncreate&&i.__listeners[n].callback(i.__listeners[n].oncreate)},I=(i,e,t)=>{if(i.__listeners)for(let n in i.__listeners)typeof i.__listeners[n]=="object"&&typeof i.__listeners[n].binding=="object"&&(i.__listeners.callback=i.__listeners.callback.bind(i.__listeners[n].binding))},T=(i,e,t)=>{if(i.__listeners){for(let n in i.__listeners)if(typeof i.__listeners[n]=="object"&&typeof i.__listeners[n].transform=="function"&&!i.__listeners[n].transformApplied){let s=i.__listeners[n].callback;i.__listeners[n].transformApplied=!0,i.__listeners.callback=_=>(_=i.__listeners[n].transform(_),s(_))}}},R=(i,e,t)=>{i.post&&!i.__operator?i.__setOperator(i.post):!i.__operator&&typeof i.get=="function"&&i.__setOperator(i.get),!i.get&&i.__operator&&(i.get=i.__operator),i.aliases&&i.aliases.forEach(n=>{t.set(n,i);let s=_=>{t.__node.nodes.delete(n)};i.__addOndisconnected(s)}),typeof t.__node.roots?.[i.__node.tag]=="object"&&i.get&&(t.__node.roots[i.__node.tag].get=i.get)},z={backprop:F,loop:q,animate:L,branching:v,triggerListenerOncreate:M,bindListener:I,transformListenerResult:T,substitute__operator:R};export{G as EventHandler,b as Graph,g as GraphNode,L as animate,F as backprop,I as bindListener,v as branching,S as getAllProperties,N as getCallbackFromString,V as instanceObject,A as isFunction,j as isNativeClass,z as loaders,q as loop,P as state,R as substitute__operator,T as transformListenerResult,M as triggerListenerOncreate,x as wrapArgs};
