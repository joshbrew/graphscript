var N=class{data={};triggers={};ctr=0;constructor(e){typeof e=="object"&&(this.data=e)}setState=e=>{Object.assign(this.data,e);let t=Object.getOwnPropertyNames(e);for(let n of t)this.triggerEvent(n,this.data[n]);if(this.triggers[m]){let n=_=>{_(e)},i=this.triggers[m].length;for(let _=i-1;_>=0;_--)n(this.triggers[m][_].onchange)}return this.data};setValue=(e,t)=>{this.data[e]=t,this.triggerEvent(e,t)};triggerEvent=(e,t)=>{if(this.triggers[e]){let n=_=>{_.onchange(t)},i=this.triggers[e].length;for(let _=i-1;_>=0;_--)n(this.triggers[e][_])}};subscribeState=e=>this.subscribeEvent(m,e);unsubscribeState=e=>this.unsubscribeEvent(m,e);subscribeEvent=(e,t,n,i)=>{if(e){n&&i&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>n[i],set:r=>{n[i]=r},enumerable:!0,configurable:!0}),this.triggers[e]||(this.triggers[e]=[]);let _=this.ctr;return this.ctr++,this.triggers[e].push({sub:_,onchange:t}),_}else return};unsubscribeEvent=(e,t)=>{let n=this.triggers[e];if(n)if(t===void 0)delete this.triggers[e],delete this.data[e];else{let i,_=n.find((r,a)=>{if(r.sub===t)return i=a,!0});return _&&n.splice(i,1),Object.keys(n).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(_),!0}};subscribeEventOnce=(e,t)=>{let n,i=_=>{t(_),this.unsubscribeEvent(e,n)};return n=this.subscribeEvent(e,i),n};getEvent=(e,t)=>{if(typeof t!="number")return this.triggers[e];for(let n in this.triggers[e])if(this.triggers[e][n].sub===t)return this.triggers[e][n]};getSnapshot=()=>{let e={};for(let t in this.data)e[t]=this.data[t]};onRemoved},m="*s";var P=new N,b=class{__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:P};__children;__parent;__operator;__listeners;__props;__args;constructor(e,t,n){this.__setProperties(e,t,n)}__setProperties=(e,t,n)=>{if((()=>{let _=e;typeof e=="function"?x(e)?e=new e:e={__operator:e,__node:{forward:!0,tag:e.name}}:typeof e=="string"&&n?.get(e)&&(e=n.get(e)),"__node"in e||(e.__node={}),e.__node.initial||(e.__node.initial=_)})(),typeof e=="object"){let _=()=>{e.__node?.state?this.__node.state=e.__node.state:n&&(e.__node.state=n.__node.state)},r=()=>{e.__props&&(typeof e.__props=="function"&&(e.__props=new e.__props),typeof e.__props=="object"&&this.__proxyObject(e.__props))},a=()=>{e.__node.tag||(e.__operator?.name?e.__node.tag=e.__operator.name:e.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},o=()=>{typeof e.__node=="string"?n?.get(e.__node.tag)?e=n.get(e.__node.tag):e.__node={}:e.__node||(e.__node={}),n&&(e.__node.graph=n),e instanceof y&&(e.__node.source=e)},h=()=>{if(!e.__parent&&t&&(e.__parent=t),t?.__node&&!(t instanceof y||e instanceof y)&&(e.__node.tag=t.__node.tag+"."+e.__node.tag),t instanceof y&&e instanceof y&&(e.__node.loaders&&Object.assign(t.__node.loaders?t.__node.loaders:{},e.__node.loaders),t.__node.mapGraphs)){e.__node.nodes.forEach(l=>{t.set(e.__node.tag+"."+l.__node.tag,l)});let d=()=>{e.__node.nodes.forEach(l=>{t.__node.nodes.delete(e.__node.tag+"."+l.__node.tag)})};this.__addOndisconnected(d)}},f=()=>{if(typeof e.default=="function"&&!e.__operator&&(e.__operator=e.default),e.__operator){if(typeof e.__operator=="string"&&n){let d=n.get(e.__operator);d&&(e.__operator=d.__operator),!e.__node.tag&&e.__operator.name&&(e.__node.tag=e.__operator.name)}typeof e.__operator=="function"&&(e.__operator=this.__setOperator(e.__operator)),e.default&&(e.default=e.__operator)}},u=()=>{e.__node=Object.assign(this.__node,e.__node);let d=Object.getOwnPropertyNames(e).filter(l=>{if(!O[l])return!0});for(let l of d)l in e&&(this[l]=e[l])},c=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(d=>d.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(d=>d.bind(this))))};_(),a(),r(),o(),h(),u(),c(),f()}};__subscribe=(e,t,n,i,_,r,a)=>{let o=(f,u=(d,l)=>l||d,c=e)=>{let d;if(r){let p=w(c,r,this.__node.graph);c=p.__callback,d=p.__args}let l=this.__node.state.subscribeEvent(f,c,this,t),g=this.__node.state.getEvent(f,l);return this.__listeners||(this.__listeners={}),this.__listeners[f]=this.__node.state.triggers[f],g&&(g.source=this.__node.tag,t&&(g.key=t),g.target=u(e,i),_&&(g.tkey=_),n&&(g.subInput=n),r&&(g.arguments=d,g.__args=r),a&&(g.__callback=a),g.node=this,g.graph=this.__node.graph,console.log(g)),l},h=f=>{let u=this.__node.graph.get(f);if(!u&&f.includes(".")){i=f.substring(0,f.lastIndexOf("."));let c=this.__node.graph.get(f.substring(0,i));_=f.lastIndexOf(".")+1,c&&typeof c[t]=="function"&&(f=(...d)=>c[_](...d))}else u.__operator&&(f=u.__operator,_="__operator");return f};if(t){if((!this.__node.localState||!this.__node.localState[t])&&this.__addLocalState(this,t),typeof e=="string"){if(a=this.__node.tag+"."+e,_=e,i){if(this.__node.graph?.get(i)){let c=this.__node.graph?.get(i);if(typeof c[e]=="function"){let d=c[e];e=(...l)=>{d(...l)}}else{let d=e;e=g=>{c[d]=g}}}}else if(typeof this[e]=="function"){let c=this[e];e=(...d)=>{c(...d)}}else this.__node.graph?.get(e)&&(e=h(e));if(typeof e!="function")return}let f,u=n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t;return typeof e=="function"?f=o(u,(c,d)=>d||c,e):e?.__node&&(f=o(u,(c,d)=>d||c.__node.unique,(...c)=>{e.__operator&&e.__operator(...c)})),f}else{if(typeof e=="string"&&(a=e,i||(i=e),this.__node.graph.get(e)&&(e=this.__node.graph.get(e)),_="__operator",typeof e!="object"))return;let f,u=n?this.__node.unique+"input":this.__node.unique;return typeof e=="function"?f=o(u,(c,d)=>d||c,e):e?.__node&&(f=o(u,(c,d)=>d||c.__node.unique,(...c)=>{e.__operator&&e.__operator(...c)})),f}};__unsubscribe=(e,t,n)=>t?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t,e):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,e);__setOperator=e=>{e=e.bind(this),this.__args&&this.__node.graph&&(e=w(e,this.__args,this.__node.graph).__callback);let t=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[t]&&this.__node.state.setValue(t,n);let i=e(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof i?.then=="function"?i.then(_=>{_!==void 0&&this.__node.state.setValue(this.__node.unique,_)}).catch(console.error):i!==void 0&&this.__node.state.setValue(this.__node.unique,i)),i},this.__parent instanceof b&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),i=()=>{this.__parent?.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(i),this.__subscribedToParent=!0}return this.__operator};__addLocalState=(e,t)=>{if(!e)return;this.__node.localState||(this.__node.localState={});let n=this.__node.localState,i=(_,r)=>{let a=this.__node.unique+"."+r,o=`${a}input`,h,f,u,c;if(typeof _[r]=="function"&&r!=="__operator")this.__props?.[r]?u=this.__props:u=n,h=()=>u[r],f=d=>{this.__props?.[r]||(d=d.bind(this)),u[r]=(...l)=>{this.__node.state.triggers[o]&&this.__node.state.setValue(o,l);let g=d(...l);return this.__node.state.triggers[a]&&(typeof g?.then=="function"?g.then(p=>{this.__node.state.triggerEvent(a,p)}).catch(console.error):this.__node.state.triggerEvent(a,g)),g}},n[r]=_[r].bind(this),c={get:h,set:f,enumerable:!0,configurable:!0};else{let d,l,g;this.__props?.[r]?g=this.__props:g=n,d=()=>g[r],l=p=>{g[r]=p,this.__node.state.triggers[a]&&this.__node.state.triggerEvent(a,p)},n[r]=_[r],c={get:d,set:l,enumerable:!0,configurable:!0}}if(Object.defineProperty(_,r,c),typeof this.__node.initial=="object"){let d=Object.getOwnPropertyDescriptor(this.__node.initial,r);(d===void 0||d?.configurable)&&Object.defineProperty(this.__node.initial,r,c)}};if(t)i(e,t);else for(let _ in e)i(e,_)};__proxyObject=e=>{let t=A(e);for(let n of t){let i={get:()=>e[n],set:_=>{e[n]=_},enumerable:!0,configurable:!0};if(Object.defineProperty(this,n,i),typeof this.__node.initial=="object"){let _=Object.getOwnPropertyDescriptor(this.__node.initial,n);(_===void 0||_?.configurable)&&Object.defineProperty(this.__node.initial,n,i)}}};__addOnconnected(e){e=e.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){e=e.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=n=>{n(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=n=>{n(this)};this.__ondisconnected.forEach(t)}}},y=class{__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:P,roots:{}};constructor(e){this.init(e)}init=e=>{if(e){let t=Object.assign({},e);delete t.roots,G(this.__node,t),e.roots&&this.load(e.roots)}};load=e=>{function t(_,r,a=!0,o=!0){if(o&&(_?Object.assign(_,r):_=Object.assign({},r),t(_,r,!0,!1)),r?.__children&&!a)r.__children?.constructor.name==="Object"?_.__children?.constructor.name==="Object"?t(_.__children,r.__children,!0,!1):_.__children=t({},r.__children,!0,!1):_.__children=r.__children;else if(a)for(let h in r)typeof r[h]=="object"?(_[h]=Object.assign({},r[h]),r[h]?.__children&&t({},r[h].__children,!1,!1)):_[h]=r[h];return _}this.__node.roots=t(this.__node.roots?this.__node.roots:{},e),console.log(this.__node.roots);let n=Object.assign({},e);n.__node&&delete n.__node;let i=this.recursiveSet(n,this,void 0,e);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let _=new b(e,this,this);this.set(_.__node.tag,_),this.runLoaders(_,this,e,e.__node.tag),_.__listeners&&(i[_.__node.tag]=_.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(i),n};setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders);runLoaders=(e,t,n,i)=>{for(let _ in this.__node.loaders)typeof this.__node.loaders[_]=="object"?(this.__node.loaders[_].init&&this.__node.loaders[_](e,t,this,this.__node.roots,n,i),this.__node.loaders[_].connected&&e.__addOnconnected(this.__node.loaders[_].connect),this.__node.loaders[_].disconnected&&e.__addOndisconnected(this.__node.loaders[_].disconnect)):typeof this.__node.loaders[_]=="function"&&this.__node.loaders[_](e,t,this,this.__node.roots,n,i)};add=(e,t)=>{let n={};typeof t=="string"&&(t=this.get(t));let i;if(typeof e=="function"?x(e)?e.prototype instanceof b?(e=e.prototype.constructor(e,t,this),i=!0):e=new e:e={__operator:e}:typeof e=="string"&&(e=this.__node.roots[e]),!!e){if(!i){let _=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(Object.getPrototypeOf(e));_.push(...r),_=_.filter(o=>!O.includes(o));let a={};for(let o of _)a[o]=e[o];e=a}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&!this.get(e.__node.tag)){let _,r=G({},e,2);if(i?_=e:_=new b(e,t,this),this.set(_.__node.tag,_),this.runLoaders(_,t,e,_.__node.tag),this.__node.roots[_.__node.tag]=r,_.__children&&(_.__children=Object.assign({},_.__children),this.recursiveSet(_.__children,_,n,_.__children)),_.__listeners){n[_.__node.tag]=Object.assign({},_.__listeners);for(let a in _.__listeners){let o=_.__listeners[a];_[a]&&(delete n[_.__node.tag][a],n[_.__node.tag][_.__node.tag+"."+a]=o),typeof o=="string"&&(_.__children?.[o]?n[_.__node.tag][a]=_.__node.tag+"."+o:t instanceof b&&(t.__node.tag===o||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===o)&&(n[_.__node.tag][a]=t.__node.tag))}}return this.setListeners(n),_.__callConnected(),_}else if(e.__node.tag)return this.get(e.__node.tag)}};recursiveSet=(e,t,n={},i)=>{let _=Object.getOwnPropertyNames(i).filter(a=>!O.includes(a)),r=Object.getOwnPropertyNames(Object.getPrototypeOf(i)).filter(a=>!O.includes(a));_.push(...r);for(let a of _){if(a.includes("__"))continue;let o=i[a];if(Array.isArray(o))continue;let h;if(typeof o=="function"?x(o)?(o=new o,o instanceof b&&(o=o.prototype.constructor(o,t,this),h=!0)):o={__operator:o}:typeof o=="string"?this.__node.nodes.get(o)?o=this.__node.nodes.get(o):o=this.__node.roots[o]:typeof o=="boolean"&&(this.__node.nodes.get(a)?o=this.__node.nodes.get(a):o=this.__node.roots[a]),o instanceof Object){if(!h&&!(o instanceof b)){let d=Object.getOwnPropertyNames(o).filter(p=>!O.includes(p)),l=Object.getOwnPropertyNames(Object.getPrototypeOf(o)).filter(p=>!O.includes(p));l.splice(l.indexOf("constructor"),1),d.push(...l);let g={};for(let p of d)g[p]=o[p];o=g}if(o.__node||(o.__node={}),o.__node.tag||(o.__node.tag=a),o.__node.initial||(o.__node.initial=e[a]),this.get(o.__node.tag)&&!(!(t instanceof y)&&t?.__node)||t?.__node&&this.get(t.__node.tag+"."+o.__node.tag))continue;let f,u=!1,c=G({},o,2);if(h||o instanceof b?f=o:(f=new b(o,t,this),u=!0),!u&&o instanceof b&&!h&&t instanceof b){let d=this.subscribe(t.__node.tag,f.__node.tag),l=g=>{this.unsubscribe(t.__node.tag,d)};f.__addOndisconnected(l)}else if(f){if(this.set(f.__node.tag,f),this.runLoaders(f,t,e[a],a),e[a]=f,this.__node.roots[f.__node.tag]=c,f.__children&&(f.__children=Object.assign({},f.__children),this.recursiveSet(f.__children,f,n,f.__children)),f.__listeners){n[f.__node.tag]=Object.assign({},f.__listeners);for(let d in f.__listeners){let l=f.__listeners[d],g=d;f[d]&&(delete n[f.__node.tag][d],g=f.__node.tag+"."+d,n[f.__node.tag][g]=l),typeof l=="string"&&(f.__children?.[l]?n[f.__node.tag][g]=f.__node.tag+"."+l:t instanceof b&&(t.__node.tag===l||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===l)&&(n[f.__node.tag][g]=t.__node.tag))}}f.__callConnected()}}}return n};remove=(e,t=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof b){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let n=i=>{for(let _ in i)this.unsubscribe(i[_]),this.delete(i[_].__node.tag),delete this.__node.roots[i[_].__node.tag],this.delete(_),delete this.__node.roots[_],i[_].__node.tag=i[_].__node.tag.substring(i[_].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(i[_]),i[_].__callDisconnected(),i[_].__children&&n(i[_].__children)};e.__children&&n(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e?.__node.graph&&(e.__node.graph=void 0),e};run=(e,...t)=>{if(typeof e=="string"){let n=this.get(e);if(!n&&e.includes(".")){if(n=this.get(e.substring(0,e.lastIndexOf("."))),typeof n?.[e.substring(e.lastIndexOf(".")+1)]=="function")return n[e.substring(e.lastIndexOf(".")+1)](...t)}else if(n?.__operator)return n.__operator(...t)}if(e?.__operator)return e?.__operator(...t)};setListeners=e=>{for(let t in e){let n=this.get(t);if(typeof e[t]=="object")for(let i in e[t]){let _=this.get(i),r;if(typeof e[t][i]!="object")e[t][i]={__callback:e[t][i]};else if(!e[t][i].__callback)for(let a in e[t][i]){typeof e[t][i][a]!="object"&&(e[t][i][a]={__callback:e[t][i][a]},n.__operator&&(e[t][i][a].__callback===!0||typeof e[t][i][a].__callback>"u")&&(e[t][i][a].__callback=n.__operator));let o=this.get(a);if(o)r=this.subscribe(o,e[t][i][a].__callback,e[t][i][a].__args,void 0,e[t][i][a].subInput);else{let h=i.substring(0,i.lastIndexOf("."));if(o=this.get(h),o){let f=i.substring(i.lastIndexOf(".")+1);r=this.subscribe(o,e[t][i][a].__callback,e[t][i][a].__args,f,e[t][i][a].subInput)}}}if("__callback"in e[t][i])if(n&&((e[t][i].__callback===!0||typeof e[t][i].__callback>"u")&&(e[t][i].__callback=n.__operator),typeof e[t][i].__callback=="function"&&(e[t][i].__callback=e[t][i].__callback.bind(n))),_)r=this.subscribe(_,e[t][i].__callback,e[t][i].__args,void 0,e[t][i].subInput);else{let a=i.substring(0,i.lastIndexOf("."));_=this.get(a),_&&(r=this.subscribe(_,e[t][i].__callback,e[t][i].__args,i.substring(i.lastIndexOf(".")+1),e[t][i].subInput))}}}};clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let n in e.__listeners){if(t&&n!==t||typeof e.__listeners[n]?.sub!="number")continue;let i=this.get(n);if(i)if(typeof!e.__listeners[n]?.__callback=="number")for(let _ in e.__listeners[n])e.__listeners[n][_]?.sub&&(this.unsubscribe(i,e.__listeners[n][_].sub,void 0,e.__listeners[n][_].subInput),e.__listeners[n][_].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n].sub,void 0,e.__listeners[n].subInput),e.__listeners[n].sub=void 0);else if(i=this.get(n.substring(0,n.lastIndexOf("."))),i)if(typeof e.__listeners[n]=="object"&&!e.__listeners[n]?.__callback)for(let _ in e.__listeners[n])typeof e.__listeners[n][_]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n][_].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n][_].subInput),e.__listeners[n][_].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n].subInput),e.__listeners[n].sub=void 0)}};get=e=>this.__node.nodes.get(e);getByUnique=e=>Array.from(this.__node.nodes.values()).find(t=>{if(t.__node.unique===e)return!0});set=(e,t)=>this.__node.nodes.set(e,t);delete=e=>this.__node.nodes.delete(e);list=()=>Array.from(this.__node.nodes.keys());getListener=(e,t,n)=>{let i=this.get(e);if(i){let _=i.__node.unique;return t&&(_+="."+t),this.__node.state.getEvent(_,n)}};getListenerJSON=()=>{let e=this.__node.state.triggers,t={};for(let n in e)e[n].forEach(i=>{let _=i;t[_.target]||(t[_.target]={});let r=_.source+_.key?"."+_.key:"";t[_.target][r]={__callback:_.__callback},_.__args&&(t[_.target][r].__args=_.__args),_.subInput&&(t[_.target][r].subInput=_.subInput)});return t};getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof b){let n;if(t)n=Object.assign({},this.__node.roots[e.__node.tag]);else{n=Object.assign({},e);for(let i in n)i.includes("__")&&delete n[i]}}};subscribe=(e,t,n,i,_,r,a)=>{let o=e;typeof e=="string"&&(o=this.get(e),!o&&e.includes(".")&&(o=this.get(e.substring(0,e.lastIndexOf("."))),i=e.substring(e.lastIndexOf(".")+1))),r instanceof b&&(r=r.__node.tag);let h;if(typeof t=="string"){h=t;let u=c=>{if(this.get(c)?.__operator){let d=this.get(c);r=c,c=function(...l){return d.__operator(...l)}}else if(c.includes(".")){r=c.substring(0,c.lastIndexOf("."));let d=this.get(r),l=c.substring(c.lastIndexOf(".")+1);a=l,typeof d[l]=="function"?d[l]instanceof b?c=d[l]:c=function(...g){return d[l](...g)}:c=function(g){return d[l]=g,d[l]}}return c};if(r){let c=this.get(r);typeof c?.[t]=="function"?(a=t,t=function(...d){return c[i](...d)}):c[i]?(a=i,c[i]instanceof b?t=c[i]:t=function(d){return c[i]=d,c[i]}):t=u(t)}else t=u(t)}let f;if(o instanceof b){let u=()=>{f=o.__subscribe(t,i,_,r,a,n,h);let c=()=>{f!==void 0&&o.__unsubscribe(f,i,_),f=void 0};o.__addOndisconnected(()=>{c(),o.__addOnconnected(()=>{f===void 0&&o.__node.graph.__node.tag===this.__node.tag&&u()})}),typeof t=="string"&&this.get(t)&&(t=this.get(t)),t instanceof b&&t.__addOndisconnected(()=>{c()})};u()}else if(typeof e=="string"){let u=this.get(e);if(u){if(t instanceof b&&t.__operator){let c=()=>{f=u.__subscribe(t.__operator,i,_,r,a,n,h);let d=()=>{f!==void 0&&u.__unsubscribe(f,i,_)};u.__addOndisconnected(()=>{d(),u.__addOnconnected(()=>{f===void 0&&u.__node.graph.__node.tag===this.__node.tag&&c()})}),t.__addOndisconnected(d)};c()}else if(typeof t=="function"||typeof t=="string"){let c=()=>{f=u.__subscribe(t,i,_,r,a,n,h);let d=()=>{f!==void 0&&u.__unsubscribe(f,i,_),f=void 0};u.__addOndisconnected(()=>{d(),u.__addOnconnected(()=>{f===void 0&&u.__node.graph.__node.tag===this.__node.tag&&c()})}),typeof t=="string"&&this.get(t)&&this.get(t).__addOndisconnected(d)};c()}}else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&(f=this.__node.state.subscribeEvent(e,t))}return f};unsubscribe=(e,t,n,i)=>e instanceof b?e.__unsubscribe(t,n,i):this.get(e)?.__unsubscribe(t,n,i);setState=e=>{this.__node.state.setState(e)}};function G(s,e,t=1/0,n=0){for(let i in e)e[i]?.constructor.name==="Object"&&n<t?(n++,s[i]?.constructor.name==="Object"?G(s[i],e[i],t,n):s[i]=G({},e[i],t,n)):s[i]=e[i];return s}function A(s){var e=[],t=s;do{var n=Object.getOwnPropertyNames(t);let i=function(_){e.indexOf(_)===-1&&e.push(_)};n.forEach(i)}while(t=Object.getPrototypeOf(t));return e}function V(s){let e=A(s),t={};for(let n of e)t[n]=s[n];return t}function x(s){return F(s)==="class"}function F(s){return typeof s=="function"?s.prototype?Object.getOwnPropertyDescriptor(s,"prototype")?.writable?"function":"class":s.constructor.name==="AsyncFunction"?"async":"arrow":""}var j=(s,e)=>{if(e.get(s)?.__operator){let t=e.get(s);return(...n)=>{t.__operator(...n)}}else if(s.includes(".")){let t=s.split("."),n=t.pop(),i=t.join("."),_=e.get(i);return typeof e.get(i)?.[n]=="function"?(...r)=>_[n](...r):()=>_[n]}else if(e.get(s)){let t=e.get(s);return()=>t}else{let t=s;return()=>t}},w=(s,e,t)=>{let n=[],i=(r,a)=>{if(r==="__output"||r==="__input"||r==="__callback")n[a]={__callback:o=>o,__args:void 0,idx:a};else if(typeof r=="string")n[a]={__callback:j(r,t),__args:void 0,idx:a};else if(typeof r=="function"){let o=r;n[a]={__callback:(...h)=>o(...h),__args:void 0,idx:a}}else if(typeof r=="object"&&(r.__input||r.__callback)){let o=function(h){let f=h.__input?h.__input:h.__callback;if(typeof h.__input=="string"&&(f={__callback:j(h.__input,t),__args:void 0,idx:a}),h.__args){let u=w(f,h.__args,t);f={__callback:u.__callback,__args:u.__args,idx:a}}else f={__callback:f,__args:void 0,idx:a};if(h.__output){let u=h.__output;if(typeof h.__output=="string"?u={__callback:j(u,t),__args:void 0,idx:a}:typeof r.__output=="object"&&(u=o(u)),typeof u?.__callback=="function"){let c=f.__callback,d=u.__callback;f={__callback:(...l)=>d(c(...l)),__args:u.__args,idx:a}}}return f};n[a]=o(r)}else{let o=r;n[a]={__callback:()=>o,__args:void 0,idx:a}}};e.forEach(i),typeof s=="string"&&(s={__callback:j(s,t),__args:void 0});let _=typeof s=="function"?s:s.__callback;return s=function(...r){let a=h=>h.__callback(...r);return _(...n.map(a))},{__callback:s,__args:n}},O=Object.getOwnPropertyNames(Object.getPrototypeOf({}));var L=(s,e,t)=>{s.__node.backward&&e instanceof b&&t.setListeners({[e.__node.tag]:{[s.__node.tag]:e}})},S=(s,e,t)=>{if(s.__operator&&!s.__node.looperSet){if(typeof s.__node.delay=="number"){let n=s.__operator;s.__setOperator((...i)=>new Promise((_,r)=>{setTimeout(async()=>{_(await n(...i))},s.__node.delay)}))}else if(s.__node.frame===!0){let n=s.__operator;s.__setOperator((...i)=>new Promise((_,r)=>{requestAnimationFrame(async()=>{_(await n(...i))})}))}if(typeof s.__node.repeat=="number"||typeof s.__node.recursive=="number"){let n=s.__operator;s.__setOperator(async(...i)=>{let _=s.__node.repeat?s.__node.repeat:s.__node.recursive,r,a=async(o,...h)=>{for(;o>0;){if(s.__node.delay||s.__node.frame){n(...h).then(async f=>{s.__node.recursive?await a(o,f):await a(o,...h)});break}else r=await n(...i);o--}};return await a(_,...i),r})}if(s.__node.loop&&typeof s.__node.loop=="number"){s.__node.looperSet=!0;let n=s.__operator,i=s.__node.loop;s.__setOperator((...r)=>{if("looping"in s.__node||(s.__node.looping=!0),s.__node.looping){let a=performance.now();n(...r),setTimeout(()=>{let h=performance.now()-a-s.__node.loop;h>0?i=s.__node.loop-h:i=s.__node.loop,i<=0&&(i=s.__node.loop),s.__operator(...r)},i)}}),s.__node.looping&&s.__operator();let _=r=>{r.__node.looping&&(r.__node.looping=!1)};s.__addOndisconnected(_)}}},q=(s,e,t)=>{if(s.__node.animate===!0||s.__animation){let n=s.__operator;s.__setOperator((..._)=>{"animating"in s.__node||(s.__node.animating=!0),s.__node.animating&&(typeof s.__animation=="function"?s.__animation(..._):n(..._),requestAnimationFrame(()=>{s.__operator(..._)}))}),(s.__node.animating||(!("animating"in s.__node)||s.__node.animating)&&s.__animation)&&setTimeout(()=>{requestAnimationFrame(s.__operator)},10);let i=_=>{_.__node.animating&&(_.__node.animating=!1)};s.__addOndisconnected(i)}},I=(s,e,t)=>{if(typeof s.__branch=="object"&&s.__operator&&!s.__branchApplied){let n=s.__operator;s.__branchApplied=!0,s.__operator=(...i)=>{let _=n(...i);for(let r in s.__branch){let a=()=>{typeof s.__branch[r].then=="function"?s.__branch[r].then(_):s.__branch[r].then instanceof b&&s.__branch[r].then.__operator?s.__branch[r].then.__operator(_):_=s.__branch[r].then};typeof s.__branch[r].if=="function"?s.__branch[r].if(_)==!0&&a():s.__branch[r].if===_&&a()}return _}}if(s.__listeners){for(let n in s.__listeners)if(typeof s.__listeners[n]=="object"&&s.__listeners[n].branch&&!s.__listeners[n].branchApplied){let i=s.__listeners[n].callback;s.__listeners[n].branchApplied=!0,s.__listeners.callback=_=>{let r=()=>{typeof s.__listeners[n].branch.then=="function"?_=s.__listeners[n].branch.then(_):s.__listeners[n].branch.then instanceof b&&s.__listeners[n].branch.then.__operator?_=s.__listeners[n].branch.then.__operator(_):_=s.__listeners[n].branch.then};return typeof s.__listeners[n].branch.if=="function"?s.__listeners[n].branch.if(_)&&r():s.__listeners[n].branch.if===_&&r(),i(_)}}}},v=(s,e,t)=>{if(s.__listeners)for(let n in s.__listeners)typeof s.__listeners[n]=="object"&&s.__listeners[n].oncreate&&s.__listeners[n].callback(s.__listeners[n].oncreate)},M=(s,e,t)=>{if(s.__listeners)for(let n in s.__listeners)typeof s.__listeners[n]=="object"&&typeof s.__listeners[n].binding=="object"&&(s.__listeners.callback=s.__listeners.callback.bind(s.__listeners[n].binding))},T=(s,e,t)=>{if(s.__listeners){for(let n in s.__listeners)if(typeof s.__listeners[n]=="object"&&typeof s.__listeners[n].transform=="function"&&!s.__listeners[n].transformApplied){let i=s.__listeners[n].callback;s.__listeners[n].transformApplied=!0,s.__listeners.callback=_=>(_=s.__listeners[n].transform(_),i(_))}}},$=(s,e,t)=>{s.post&&!s.__operator?s.__setOperator(s.post):!s.__operator&&typeof s.get=="function"&&s.__setOperator(s.get),!s.get&&s.__operator&&(s.get=s.__operator),s.aliases&&s.aliases.forEach(n=>{t.set(n,s);let i=_=>{t.__node.nodes.delete(n)};s.__addOndisconnected(i)}),typeof t.__node.roots?.[s.__node.tag]=="object"&&s.get&&(t.__node.roots[s.__node.tag].get=s.get)},J={backprop:L,loop:S,animate:q,branching:I,triggerListenerOncreate:v,bindListener:M,transformListenerResult:T,substitute__operator:$};export{N as EventHandler,y as Graph,b as GraphNode,q as animate,L as backprop,M as bindListener,I as branching,A as getAllProperties,j as getCallbackFromString,V as instanceObject,F as isFunction,x as isNativeClass,J as loaders,S as loop,P as state,$ as substitute__operator,T as transformListenerResult,v as triggerListenerOncreate,w as wrapArgs};
