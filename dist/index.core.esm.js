var b=class{constructor(e){this.pushToState={};this.data={};this.triggers={};this.ctr=0;this.setState=e=>{Object.assign(this.data,e);let t=Object.getOwnPropertyNames(e);for(let n of t)this.triggerEvent(n,this.data[n]);if(this.triggers[y]){let n=i=>{i(e)};this.triggers[y].forEach(i=>{n(i.onchange)})}return this.data};this.setValue=(e,t)=>{this.data[e]=t,this.triggerEvent(e,t)};this.triggerEvent=(e,t)=>{if(this.triggers[e]){let n=i=>i.onchange(t,this.triggers[e]);this.triggers[e].forEach(n)}};this.subscribeState=e=>this.subscribeEvent(y,e);this.unsubscribeState=e=>this.unsubscribeEvent(y,e);this.subscribeEvent=(e,t,n,i)=>{if(e){n&&i&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>n[i],set:o=>{n[i]=o},enumerable:!0,configurable:!0}),this.triggers[e]||(this.triggers[e]=[]);let _=this.ctr;return this.ctr++,this.triggers[e].push({sub:_,onchange:t}),_}else return};this.unsubscribeEvent=(e,t)=>{let n=this.triggers[e];if(n)if(t===void 0)delete this.triggers[e],delete this.data[e];else{let i,_=n.find((o,r)=>{if(o.sub===t)return i=r,!0});return _&&n.splice(i,1),Object.keys(n).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(_),!0}};this.subscribeEventOnce=(e,t)=>{let n,i=_=>{t(_),this.unsubscribeEvent(e,n)};n=this.subscribeEvent(e,i)};this.getEvent=(e,t)=>{for(let n in this.triggers[e])if(this.triggers[e][n].sub===t)return this.triggers[e][n]};this.getSnapshot=()=>{let e={};for(let t in this.data)e[t]=this.data[t]};typeof e=="object"&&(this.data=e)}},y="*s";var j=new b,u=class{constructor(e,t,n){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:j};this.__setProperties=(e,t,n)=>{if((()=>{let _=e;typeof e=="function"?m(e)?e=new e:e={__operator:e,__node:{forward:!0,tag:e.name}}:typeof e=="string"&&n?.get(e)&&(e=n.get(e)),e.__node.initial||(e.__node.initial=_)})(),typeof e=="object"){let _=()=>{e.__node?.state&&(this.__node.state=e.__node.state)},o=()=>{e.__props&&(typeof e.__props=="function"&&(e.__props=new e.__props),typeof e.__props=="object"&&this.__proxyObject(e.__props))},r=()=>{e.__node.tag||(e.__operator?.name?e.__node.tag=e.__operator.name:e.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},c=()=>{typeof e.__node=="string"?n?.get(e.__node.tag)?e=n.get(e.__node.tag):e.__node={}:e.__node||(e.__node={}),n&&(e.__node.graph=n),e instanceof p&&(e.__node.source=e)},a=()=>{if(!e.__parent&&t&&(e.__parent=t),t?.__node&&!(t instanceof p||e instanceof p)&&(e.__node.tag=t.__node.tag+"."+e.__node.tag),t instanceof p&&e instanceof p&&(e.__node.loaders&&Object.assign(t.__node.loaders?t.__node.loaders:{},e.__node.loaders),t.__node.mapGraphs)){e.__node.nodes.forEach(g=>{t.set(e.__node.tag+"."+g.__node.tag,g)});let h=()=>{e.__node.nodes.forEach(g=>{t.__node.nodes.delete(e.__node.tag+"."+g.__node.tag)})};this.__addOndisconnected(h)}},f=()=>{if(typeof e.default=="function"&&!e.__operator&&(e.__operator=e.default),e.__operator){if(typeof e.__operator=="string"&&n){let h=n.get(e.__operator);h&&(e.__operator=h.__operator),!e.__node.tag&&e.__operator.name&&(e.__node.tag=e.__operator.name)}typeof e.__operator=="function"&&(e.__operator=this.__setOperator(e.__operator)),e.default&&(e.default=e.__operator)}},l=()=>{e.__node=Object.assign(this.__node,e.__node);let h=Object.getOwnPropertyNames(e);for(let g of h)this[g]=e[g]},d=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(h=>h.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(h=>h.bind(this))))};_(),r(),o(),c(),a(),l(),d(),f()}};this.__subscribe=(e,t,n,i,_)=>{let o=(c,a=(l,d)=>l,f=e)=>{let l=this.__node.state.subscribeEvent(c,f,this,t),d=this.__node.state.getEvent(c,l);return d&&(d.source=this.__node.tag,t&&(d.key=t),d.target=a(e),i&&(d.bound=i)),l},r=c=>{if(!this.__node.graph.get(c)&&c.includes(".")){let f=this.__node.graph.get(c.substring(0,c.lastIndexOf("."))),l=c.substring(c.lastIndexOf(".")+1);f&&typeof f[l]=="function"&&(c=(...d)=>f[l](...d))}};if(t){if((!this.__node.localState||!this.__node.localState[t])&&this.__addLocalState(this,t),typeof e=="string"){if(_){if(this.__node.graph?.get(_)){let f=this.__node.graph?.get(_);if(typeof f[e]=="function"){let l=f[e];e=(...d)=>{l(...d)}}else{let l=e;e=h=>{f[l]=h}}}}else if(typeof this[e]=="function"){let f=this[e];e=(...l)=>{f(...l)}}else this.__node.graph?.get(e)&&r(e);if(typeof e!="function")return}let c,a=n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t;return typeof e=="function"?c=o(a):e?.__node&&(c=o(a,(f,l)=>l||f.__node.unique,(...f)=>{e.__operator&&e.__operator(...f)})),c}else{if(typeof e=="string"&&(this.__node.graph.get(e)&&(e=this.__node.graph.get(e)),typeof e!="object"))return;let c,a=n?this.__node.unique+"input":this.__node.unique;return typeof e=="function"?c=o(a):e?.__node&&(c=o(a,(f,l)=>l||f.__node.unique,(...f)=>{e.__operator&&e.__operator(...f)})),c}};this.__unsubscribe=(e,t,n)=>t?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t,e):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,e);this.__setOperator=e=>{e=e.bind(this),this.__args&&this.__node.graph&&(e=N(e,this.__args,this.__node.graph));let t=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[t]&&this.__node.state.setValue(t,n);let i=e(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof i?.then=="function"?i.then(_=>{_!==void 0&&this.__node.state.setValue(this.__node.unique,_)}).catch(console.error):i!==void 0&&this.__node.state.setValue(this.__node.unique,i)),i},this.__parent instanceof u&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),i=()=>{this.__parent?.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(i),this.__subscribedToParent=!0}return this.__operator};this.__addLocalState=(e,t)=>{if(!e)return;this.__node.localState||(this.__node.localState={});let n=this.__node.localState,i=(_,o)=>{let r=this.__node.unique+"."+o,c=`${r}input`;if(typeof _[o]=="function"&&o!=="__operator"){let a=_[o].bind(this);_[o]=(...f)=>{this.__node.state.triggers[c]&&this.__node.state.setValue(c,f);let l=a(...f);return this.__node.state.triggers[r]&&(typeof l?.then=="function"?l.then(d=>{this.__node.state.triggerEvent(r,d)}).catch(console.error):this.__node.state.triggerEvent(r,l)),l}}else{let a,f;this.__props?.[o]?(a=()=>this.__props[o],f=d=>{this.__props[o]=d,this.__node.state.triggers[r]&&this.__node.state.triggerEvent(r,d)}):(n[o]=_[o],a=()=>n[o],f=d=>{n[o]=d,this.__node.state.triggers[r]&&this.__node.state.triggerEvent(r,d)});let l={get:a,set:f,enumerable:!0,configurable:!0};if(Object.defineProperty(_,o,l),typeof this.__node.initial=="object"){let d=Object.getOwnPropertyDescriptor(this.__node.initial,o);(d===void 0||d?.configurable)&&Object.defineProperty(this.__node.initial,o,l)}}};if(t)i(e,t);else for(let _ in e)i(e,_)};this.__proxyObject=e=>{let t=x(e);for(let n of t)if(typeof e[n]=="function")this[n]=(...i)=>e[n](...i);else{let i={get:()=>e[n],set:_=>{e[n]=_},enumerable:!0,configurable:!0};if(Object.defineProperty(this,n,i),typeof this.__node.initial=="object"){let _=Object.getOwnPropertyDescriptor(this.__node.initial,n);(_===void 0||_?.configurable)&&Object.defineProperty(this.__node.initial,n,i)}}};this.__setProperties(e,t,n)}__addOnconnected(e){e=e.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){e=e.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=n=>{n(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=n=>{n(this)};this.__ondisconnected.forEach(t)}}},p=class{constructor(e){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:j,roots:{}};this.init=e=>{if(e){let t=Object.assign({},e);delete t.roots,G(this.__node,t),e.roots&&this.load(e.roots)}};this.load=e=>{function t(_,o,r=!0,c=!0){if(c&&(_?Object.assign(_,o):_=Object.assign({},o),t(_,o,!0,!1)),o.__children&&!r)o.__children?.constructor.name==="Object"?_.__children?.constructor.name==="Object"?t(_.__children,o.__children,!0,!1):_.__children=t({},o.__children,!0,!1):_.__children=o.__children;else if(r)for(let a in o)_[a]=Object.assign({},o[a]),o[a].__children&&t({},o[a].__children,!1,!1);return _}this.__node.roots=t(this.__node.roots?this.__node.roots:{},e);let n=Object.assign({},e);n.__node&&delete n.__node;let i=this.recursiveSet(n,this,void 0,e);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let _=new u(e,this,this);this.set(_.__node.tag,_),this.runLoaders(_,this,e,e.__node.tag),_.__listeners&&(i[_.__node.tag]=_.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(i),n};this.setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders);this.runLoaders=(e,t,n,i)=>{for(let _ in this.__node.loaders)typeof this.__node.loaders[_]=="object"?(this.__node.loaders[_].init&&this.__node.loaders[_](e,t,this,this.__node.roots,n,i),this.__node.loaders[_].connected&&e.__addOnconnected(this.__node.loaders[_].connect),this.__node.loaders[_].disconnected&&e.__addOndisconnected(this.__node.loaders[_].disconnect)):typeof this.__node.loaders[_]=="function"&&this.__node.loaders[_](e,t,this,this.__node.roots,n,i)};this.add=(e,t)=>{let n={};typeof t=="string"&&(t=this.get(t));let i;if(typeof e=="function"?m(e)?e.prototype instanceof u?(e=e.prototype.constructor(e,t,this),i=!0):e=new e:e={__operator:e}:typeof e=="string"&&(e=this.__node.roots[e]),!!e){if(!i){let _=Object.getOwnPropertyNames(e),o={};for(let r of _)o[r]=e[r];e=o}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&(!e?.__node?.tag||!this.get(e.__node.tag))){let _;if(i?_=e:_=new u(e,t,this),this.set(_.__node.tag,_),this.runLoaders(_,t,e,_.__node.tag),this.__node.roots[_.__node.tag]=e,_.__children&&(_.__children=Object.assign({},_.__children),this.recursiveSet(_.__children,_,n,_.__children)),_.__listeners){n[_.__node.tag]=Object.assign({},_.__listeners);for(let o in _.__listeners){let r=_.__listeners[o];_[o]&&(delete n[_.__node.tag][o],n[_.__node.tag][_.__node.tag+"."+o]=r),typeof r=="string"&&(_.__children?.[r]?n[_.__node.tag][o]=_.__node.tag+"."+r:t instanceof u&&(t.__node.tag===r||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===r)&&(n[_.__node.tag][o]=t.__node.tag))}}return this.setListeners(n),_.__callConnected(),_}}};this.recursiveSet=(e,t,n={},i)=>{let _=Object.getOwnPropertyNames(i);for(let o of _){if(o.includes("__"))continue;let r=i[o];if(Array.isArray(r))continue;let c;if(typeof r=="function"?m(r)?(r=new r,r instanceof u&&(r=r.prototype.constructor(r,t,this),c=!0)):r={__operator:r}:typeof r=="string"?this.__node.nodes.get(r)?r=this.__node.nodes.get(r):r=this.__node.roots[r]:typeof r=="boolean"&&(this.__node.nodes.get(o)?r=this.__node.nodes.get(o):r=this.__node.roots[o]),typeof r=="object"){if(!c&&!(r instanceof u)){let l=Object.getOwnPropertyNames(r),d={};for(let h of l)d[h]=r[h];r=d}if(r.__node||(r.__node={}),r.__node.tag||(r.__node.tag=o),r.__node.initial||(r.__node.initial=e[o]),this.get(r.__node.tag)&&!(!(t instanceof p)&&t?.__node)||t?.__node&&this.get(t.__node.tag+"."+r.__node.tag))continue;let a,f=!1;if(c||r instanceof u?a=r:(a=new u(r,t,this),f=!0),!f&&r instanceof u&&!c&&t instanceof u){let l=this.subscribe(t.__node.tag,a.__node.tag),d=h=>{this.unsubscribe(t.__node.tag,l)};a.__addOndisconnected(d)}else{if(this.set(a.__node.tag,a),this.runLoaders(a,t,e[o],o),e[o]=a,this.__node.roots[a.__node.tag]=r,a.__children&&(a.__children=Object.assign({},a.__children),this.recursiveSet(a.__children,a,n,a.__children)),a.__listeners){n[a.__node.tag]=Object.assign({},a.__listeners);for(let l in a.__listeners){let d=a.__listeners[l],h=l;a[l]&&(delete n[a.__node.tag][l],h=a.__node.tag+"."+l,n[a.__node.tag][h]=d),typeof d=="string"&&(a.__children?.[d]?n[a.__node.tag][h]=a.__node.tag+"."+d:t instanceof u&&(t.__node.tag===d||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===d)&&(n[a.__node.tag][h]=t.__node.tag))}}a.__callConnected()}}}return n};this.remove=(e,t=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof u){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let n=i=>{for(let _ in i)this.unsubscribe(i[_]),this.delete(i[_].__node.tag),delete this.__node.roots[i[_].__node.tag],this.delete(_),delete this.__node.roots[_],i[_].__node.tag=i[_].__node.tag.substring(i[_].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(i[_]),i[_].__callDisconnected(),i[_].__children&&n(i[_].__children)};e.__children&&n(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e?.__node.graph&&(e.__node.graph=void 0),e};this.run=(e,...t)=>{if(typeof e=="string"){let n=this.get(e);if(!n&&e.includes(".")){if(n=this.get(e.substring(0,e.lastIndexOf("."))),typeof n?.[e.substring(e.lastIndexOf(".")+1)]=="function")return n[e.substring(e.lastIndexOf(".")+1)](...t)}else if(n?.__operator)return n.__operator(...t)}if(e?.__operator)return e?.__operator(...t)};this.setListeners=e=>{for(let t in e){let n=this.get(t);if(n&&typeof e[t]=="object")for(let i in e[t]){let _=this.get(i),o;if(typeof e[t][i]!="object")e[t][i]={__callback:e[t][i]};else if(!e[t][i].__callback)for(let r in e[t][i]){typeof e[t][i][r]!="object"&&(e[t][i][r]={__callback:e[t][i][r]},n.__operator&&(e[t][i][r].__callback===!0||typeof e[t][i][r].__callback>"u")&&(e[t][i][r].__callback=n.__operator));let c=this.get(r);if(c)o=this.subscribe(c,e[t][i][r].__callback,e[t][i].__args,void 0,e[t][i].inputState,t,i),typeof n.__listeners[i][r]!="object"&&(n.__listeners[i][r]={__callback:e[t][i][r].__callback,inputState:e[t][i][r]?.inputState,target:t,bound:i}),n.__listeners[i][r].sub=o;else{let a=i.substring(0,i.lastIndexOf("."));if(c=this.get(a),c){let f=i.substring(i.lastIndexOf(".")+1);o=this.subscribe(c,e[t][i][r].__callback,e[t][i][r].__args,f,e[t][i][r].inputState,t,i),typeof n.__listeners[i][r]!="object"&&(n.__listeners[i][r]={__callback:e[t][i][r].__callback,inputState:e[t][i][r]?.inputState,target:t,bound:i}),n.__listeners[i][r].sub=o}}}if("__callback"in e[t][i])if((e[t][i].__callback===!0||typeof e[t][i].__callback>"u")&&(e[t][i].__callback=n.__operator),typeof e[t][i].__callback=="function"&&(e[t][i].__callback=e[t][i].__callback.bind(n)),typeof n.__listeners!="object"&&(n.__listeners={}),_)o=this.subscribe(_,e[t][i].__callback,e[t][i].__args,void 0,e[t][i].inputState,t,i),typeof n.__listeners[i]!="object"&&(n.__listeners[i]={__callback:e[t][i].__callback,inputState:e[t][i]?.inputState,target:t,bound:i}),n.__listeners[i].sub=o;else{let r=i.substring(0,i.lastIndexOf("."));_=this.get(r),_&&(o=this.subscribe(_,e[t][i].__callback,e[t][i].__args,i.substring(i.lastIndexOf(".")+1),e[t][i].inputState,t,i),typeof n.__listeners[i]!="object"&&(n.__listeners[i]={__callback:e[t][i].__callback,inputState:e[t][i]?.inputState,target:t,bound:i}),n.__listeners[i].sub=o)}}}};this.clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let n in e.__listeners){if(t&&n!==t||typeof e.__listeners[n]?.sub!="number")continue;let i=this.get(n);if(i)if(typeof!e.__listeners[n]?.__callback=="number")for(let _ in e.__listeners[n])e.__listeners[n][_]?.sub&&(this.unsubscribe(i,e.__listeners[n][_].sub,void 0,e.__listeners[n][_].inputState),e.__listeners[n][_].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n].sub,void 0,e.__listeners[n].inputState),e.__listeners[n].sub=void 0);else if(i=this.get(n.substring(0,n.lastIndexOf("."))),i)if(typeof e.__listeners[n]=="object"&&!e.__listeners[n]?.__callback)for(let _ in e.__listeners[n])typeof e.__listeners[n][_]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n][_].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n][_].inputState),e.__listeners[n][_].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n].inputState),e.__listeners[n].sub=void 0)}};this.get=e=>this.__node.nodes.get(e);this.set=(e,t)=>this.__node.nodes.set(e,t);this.delete=e=>this.__node.nodes.delete(e);this.getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof u){let n;if(t)n=Object.assign({},this.__node.roots[e.__node.tag]);else{n=Object.assign({},e);for(let i in n)i.includes("__")&&delete n[i]}}};this.subscribe=(e,t,n,i,_,o,r)=>{let c=e;if(typeof e=="string"&&(c=this.get(e),!c&&e.includes(".")&&(c=this.get(e.substring(0,e.lastIndexOf("."))),i=e.substring(e.lastIndexOf(".")+1))),o instanceof u&&(o=o.__node.tag),typeof t=="string"){let f=t,l=d=>{if(this.get(d)?.__operator){let h=this.get(d);d=function(...g){return h.__operator(...g)}}else if(d.includes(".")){let h=this.get(d.substring(0,d.lastIndexOf("."))),g=d.substring(d.lastIndexOf(".")+1);typeof h[g]=="function"?h[g]instanceof u?d=h[g]:d=function(...O){return h[g](...O)}:d=function(O){return h[g]=O,h[g]}}return d};if(o){let d=this.get(o);typeof d?.[t]=="function"?t=function(...h){return d[f](...h)}:d[f]?d[f]instanceof u?t=d[f]:t=function(h){return d[f]=h,d[f]}:t=l(t)}else t=l(t)}(typeof t=="function"||t instanceof u)&&n&&(t instanceof u&&t.__operator&&(t=function(f){return t.__operator(f)}),t=N(t,n,this));let a;if(c instanceof u){let f=()=>{a=c.__subscribe(t,i,_,o,r),o&&this.get(o)&&this.get(o).__listeners[r]&&(this.get(o).__listeners[r].sub=a);let l=()=>{a!==void 0&&c.__unsubscribe(a,i,_),a=void 0};c.__addOndisconnected(()=>{l(),c.__addOnconnected(()=>{a===void 0&&c.__node.graph.__node.tag===this.__node.tag&&f()})}),typeof t=="string"&&this.get(t)&&(t=this.get(t)),t instanceof u&&t.__addOndisconnected(()=>{l()})};f()}else if(typeof e=="string"){let f=this.get(e);if(f){if(t instanceof u&&t.__operator){let l=()=>{a=f.__subscribe(t.__operator,i,_,o,r),o&&this.get(o)&&this.get(o).__listeners[r]&&(this.get(o).__listeners[r].sub=a);let d=()=>{a!==void 0&&f.__unsubscribe(a,i,_)};f.__addOndisconnected(()=>{d(),f.__addOnconnected(()=>{a===void 0&&f.__node.graph.__node.tag===this.__node.tag&&l()})}),t.__addOndisconnected(d)};l()}else if(typeof t=="function"||typeof t=="string"){let l=()=>{a=f.__subscribe(t,i,_,o,r),o&&this.get(o)&&this.get(o).__listeners[r]&&(this.get(o).__listeners[r].sub=a);let d=()=>{a!==void 0&&f.__unsubscribe(a,i,_),a=void 0};f.__addOndisconnected(()=>{d(),f.__addOnconnected(()=>{a===void 0&&f.__node.graph.__node.tag===this.__node.tag&&l()})}),typeof t=="string"&&this.get(t)&&this.get(t).__addOndisconnected(d),this.__node.state.getEvent(f.__node.unique,a).source=e};l()}}else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&(a=this.__node.state.subscribeEvent(e,t))}return a};this.unsubscribe=(e,t,n,i)=>e instanceof u?e.__unsubscribe(t,n,i):this.get(e)?.__unsubscribe(t,n,i);this.setState=e=>{this.__node.state.setState(e)};this.init(e)}};function G(s,e){for(let t in e)e[t]?.constructor.name==="Object"?s[t]?.constructor.name==="Object"?G(s[t],e[t]):s[t]=G({},e[t]):s[t]=e[t];return s}function x(s){var e=[],t=s;do{var n=Object.getOwnPropertyNames(t);let i=function(_){e.indexOf(_)===-1&&e.push(_)};n.forEach(i)}while(t=Object.getPrototypeOf(t));return e}function C(s){let e=x(s),t={};for(let n of e)t[n]=s[n];return t}function m(s){return S(s)==="class"}function S(s){return typeof s=="function"?s.prototype?Object.getOwnPropertyDescriptor(s,"prototype")?.writable?"function":"class":s.constructor.name==="AsyncFunction"?"async":"arrow":""}var N=(s,e,t)=>{let n=[],i=r=>{if(t.get(r)?.__operator){let c=t.get(r);return(...a)=>{c.__operator(...a)}}else if(r.includes(".")){let c=r.split("."),a=c.pop(),f=c.join("."),l=t.get(f);return typeof t.get(f)?.[a]=="function"?(...d)=>l[a](...d):()=>l[a]}else if(t.get(r)){let c=t.get(r);return()=>c}else{let c=r;return()=>c}},_=(r,c)=>{if(r==="__output"||r==="__input")n[c]=a=>a;else if(typeof r=="string")n[c]=i(r);else if(typeof r=="function"){let a=r;n[c]=(...f)=>a(...f)}else if(typeof r=="object"&&r.__input){let a=function(f){let l=f.__input;if(typeof f.__input=="string"&&(l=i(f.__input)),f.__args&&(l=N(l,f.__args,t)),f.__output){let d=f.__output;if(typeof f.__output=="string"?d=i(d):typeof r.__output=="object"&&(d=a(d)),typeof d=="function"){let h=l;l=(...g)=>d(h(...g))}}return l};n[c]=a(r)}else{let a=r;n[c]=()=>a}};e.forEach(_),typeof s=="string"&&(s=i(s));let o=s;return s=function(...r){let c=a=>a(...r);return o(...n.map(c))},s};var w=(s,e,t)=>{s.__node.backward&&e instanceof u&&t.setListeners({[e.__node.tag]:{[s.__node.tag]:e}})},P=(s,e,t)=>{if(s.__operator&&!s.__node.looperSet){if(typeof s.__node.delay=="number"){let n=s.__operator;s.__setOperator((...i)=>new Promise((_,o)=>{setTimeout(async()=>{_(await n(...i))},s.__node.delay)}))}else if(s.__node.frame===!0){let n=s.__operator;s.__setOperator((...i)=>new Promise((_,o)=>{requestAnimationFrame(async()=>{_(await n(...i))})}))}if(typeof s.__node.repeat=="number"||typeof s.__node.recursive=="number"){let n=s.__operator;s.__setOperator(async(...i)=>{let _=s.__node.repeat?s.__node.repeat:s.__node.recursive,o,r=async(c,...a)=>{for(;c>0;){if(s.__node.delay||s.__node.frame){n(...a).then(async f=>{s.__node.recursive?await r(c,f):await r(c,...a)});break}else o=await n(...i);c--}};return await r(_,...i),o})}if(s.__node.loop&&typeof s.__node.loop=="number"){s.__node.looperSet=!0;let n=s.__operator,i=s.__node.loop;s.__setOperator((...o)=>{if("looping"in s.__node||(s.__node.looping=!0),s.__node.looping){let r=performance.now();n(...o),setTimeout(()=>{let a=performance.now()-r-s.__node.loop;a>0?i=s.__node.loop-a:i=s.__node.loop,i<=0&&(i=s.__node.loop),s.__operator(...o)},i)}}),s.__node.looping&&s.__operator();let _=o=>{o.__node.looping&&(o.__node.looping=!1)};s.__addOndisconnected(_)}}},A=(s,e,t)=>{if(s.__node.animate===!0||s.__animation){let n=s.__operator;s.__setOperator((..._)=>{"animating"in s.__node||(s.__node.animating=!0),s.__node.animating&&(typeof s.__animation=="function"?s.__animation(..._):n(..._),requestAnimationFrame(()=>{s.__operator(..._)}))}),(s.__node.animating||(!("animating"in s.__node)||s.__node.animating)&&s.__animation)&&setTimeout(()=>{requestAnimationFrame(s.__operator)},10);let i=_=>{_.__node.animating&&(_.__node.animating=!1)};s.__addOndisconnected(i)}},q=(s,e,t)=>{if(typeof s.__branch=="object"&&s.__operator&&!s.__branchApplied){let n=s.__operator;s.__branchApplied=!0,s.__operator=(...i)=>{let _=n(...i);for(let o in s.__branch){let r=()=>{typeof s.__branch[o].then=="function"?s.__branch[o].then(_):s.__branch[o].then instanceof u&&s.__branch[o].then.__operator?s.__branch[o].then.__operator(_):_=s.__branch[o].then};typeof s.__branch[o].if=="function"?s.__branch[o].if(_)==!0&&r():s.__branch[o].if===_&&r()}return _}}if(s.__listeners){for(let n in s.__listeners)if(typeof s.__listeners[n]=="object"&&s.__listeners[n].branch&&!s.__listeners[n].branchApplied){let i=s.__listeners[n].callback;s.__listeners[n].branchApplied=!0,s.__listeners.callback=_=>{let o=()=>{typeof s.__listeners[n].branch.then=="function"?_=s.__listeners[n].branch.then(_):s.__listeners[n].branch.then instanceof u&&s.__listeners[n].branch.then.__operator?_=s.__listeners[n].branch.then.__operator(_):_=s.__listeners[n].branch.then};return typeof s.__listeners[n].branch.if=="function"?s.__listeners[n].branch.if(_)&&o():s.__listeners[n].branch.if===_&&o(),i(_)}}}},L=(s,e,t)=>{if(s.__listeners)for(let n in s.__listeners)typeof s.__listeners[n]=="object"&&s.__listeners[n].oncreate&&s.__listeners[n].callback(s.__listeners[n].oncreate)},F=(s,e,t)=>{if(s.__listeners)for(let n in s.__listeners)typeof s.__listeners[n]=="object"&&typeof s.__listeners[n].binding=="object"&&(s.__listeners.callback=s.__listeners.callback.bind(s.__listeners[n].binding))},M=(s,e,t)=>{if(s.__listeners){for(let n in s.__listeners)if(typeof s.__listeners[n]=="object"&&typeof s.__listeners[n].transform=="function"&&!s.__listeners[n].transformApplied){let i=s.__listeners[n].callback;s.__listeners[n].transformApplied=!0,s.__listeners.callback=_=>(_=s.__listeners[n].transform(_),i(_))}}},k=(s,e,t)=>{s.post&&!s.__operator?s.__setOperator(s.post):!s.__operator&&typeof s.get=="function"&&s.__setOperator(s.get),!s.get&&s.__operator&&(s.get=s.__operator),s.aliases&&s.aliases.forEach(n=>{t.set(n,s);let i=_=>{t.__node.nodes.delete(n)};s.__addOndisconnected(i)}),typeof t.__node.roots?.[s.__node.tag]=="object"&&s.get&&(t.__node.roots[s.__node.tag].get=s.get)},v={backprop:w,loop:P,animate:A,branching:q,triggerListenerOncreate:L,bindListener:F,transformListenerResult:M,substitute__operator:k};export{b as EventHandler,p as Graph,u as GraphNode,A as animate,w as backprop,F as bindListener,q as branching,x as getAllProperties,C as instanceObject,S as isFunction,m as isNativeClass,v as loaders,P as loop,j as state,k as substitute__operator,M as transformListenerResult,L as triggerListenerOncreate,N as wrapArgs};
