(()=>{var x=class{data={};triggers={};ctr=0;constructor(e){typeof e=="object"&&(this.data=e)}setState=e=>{Object.assign(this.data,e);let t=Object.getOwnPropertyNames(e);for(let n of t)this.triggerEvent(n,this.data[n]);if(this.triggers[G]){let n=s=>{s(e)},i=this.triggers[G].length;for(let s=i-1;s>=0;s--)n(this.triggers[G][s].onchange)}return this.data};setValue=(e,t)=>{this.data[e]=t,this.triggerEvent(e,t)};triggerEvent=(e,t)=>{if(this.triggers[e]){let n=s=>{s.onchange(t)},i=this.triggers[e].length;for(let s=i-1;s>=0;s--)n(this.triggers[e][s])}};subscribeState=e=>this.subscribeEvent(G,e);unsubscribeState=e=>this.unsubscribeEvent(G,e);subscribeEvent=(e,t,n,i)=>{if(e){n&&i&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>n[i],set:r=>{n[i]=r},enumerable:!0,configurable:!0}),this.triggers[e]||(this.triggers[e]=[]);let s=this.ctr;return this.ctr++,this.triggers[e].push({sub:s,onchange:t}),s}else return};unsubscribeEvent=(e,t)=>{let n=this.triggers[e];if(n)if(t===void 0)delete this.triggers[e],delete this.data[e];else{let i,s=n.find((r,o)=>{if(r.sub===t)return i=o,!0});return s&&n.splice(i,1),Object.keys(n).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(s),!0}};subscribeEventOnce=(e,t)=>{let n,i=s=>{t(s),this.unsubscribeEvent(e,n)};return n=this.subscribeEvent(e,i),n};getEvent=(e,t)=>{if(typeof t!="number")return this.triggers[e];for(let n in this.triggers[e])if(this.triggers[e][n].sub===t)return this.triggers[e][n]};getSnapshot=()=>{let e={};for(let t in this.data)e[t]=this.data[t]};onRemoved},G="*s";var F=new x,w=class extends Function{__bound;__call;constructor(){return super("return this.__bound.__call.apply(this.__bound, arguments)"),this.__bound=this.bind(this),this.__bound}},p=class _ extends w{__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:F};__children;__parent;__operator;__listeners;__props;__args;constructor(e,t,n){super(),this.__setProperties(e,t,n)}__setProperties=(e,t,n)=>{if((()=>{let s=e;typeof e=="function"?P(e)?e=new e:e={__operator:e,__node:{forward:!0,tag:e.name}}:typeof e=="string"&&n?.get(e)&&(e=n.get(e)),"__node"in e||(e.__node={}),e.__node.initial||(e.__node.initial=s)})(),typeof e=="object"){let s=()=>{e.__node?.state?this.__node.state=e.__node.state:n&&(e.__node.state=n.__node.state)},r=()=>{e.__props&&(typeof e.__props=="function"&&(e.__props=new e.__props),typeof e.__props=="object"&&this.__proxyObject(e.__props))},o=()=>{e.__node.tag||(e.__operator?.name?e.__node.tag=e.__operator.name:e.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},l=()=>{typeof e.__node=="string"?n?.get(e.__node.tag)?e=n.get(e.__node.tag):e.__node={}:e.__node||(e.__node={}),n&&(e.__node.graph=n),e instanceof y&&(e.__node.source=e)},f=()=>{if(!e.__parent&&t&&(e.__parent=t),t?.__node&&!(t instanceof y||e instanceof y)&&(e.__node.tag=t.__node.tag+"."+e.__node.tag),t instanceof y&&e instanceof y&&(e.__node.loaders&&Object.assign(t.__node.loaders?t.__node.loaders:{},e.__node.loaders),t.__node.mapGraphs)){e.__node.nodes.forEach(h=>{t.set(e.__node.tag+"."+h.__node.tag,h)});let u=()=>{e.__node.nodes.forEach(h=>{t.__node.nodes.delete(e.__node.tag+"."+h.__node.tag)})};this.__addOndisconnected(u)}},a=()=>{if(typeof e.default=="function"&&!e.__operator&&(e.__operator=e.default),e.__operator){if(typeof e.__operator=="string"&&n){let u=n.get(e.__operator);u&&(e.__operator=u.__operator),!e.__node.tag&&e.__operator.name&&(e.__node.tag=e.__operator.name)}typeof e.__operator=="function"&&(e.__operator=this.__setOperator(e.__operator)),e.default&&(e.default=e.__operator)}},d=()=>{e.__node=Object.assign(this.__node,e.__node);let u=Object.getOwnPropertyNames(e).filter(h=>{if(!O[h])return!0});for(let h of u)h in e&&h!=="name"&&(this[h]=e[h])},c=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(u=>u.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(u=>u.bind(this))))};s(),o(),r(),l(),f(),d(),c(),a()}};__subscribe=(e,t,n,i,s,r,o)=>{let l=(a,d=(u,h)=>h||u,c=e)=>{let u;if(r){let b=A(c,r,this.__node.graph);c=b.__callback,u=b.__args}let h=this.__node.state.subscribeEvent(a,c,this,t),g=this.__node.state.getEvent(a,h);return this.__listeners||(this.__listeners={}),this.__listeners[a]=this.__node.state.triggers[a],g&&(g.source=this.__node.tag,t&&(g.key=t),g.target=d(e,i),s&&(g.tkey=s),n&&(g.subInput=n),r&&(g.arguments=u,g.__args=r),o&&(g.__callback=o),g.node=this,g.graph=this.__node.graph),h},f=a=>{let d=this.__node.graph.get(a);if(!d&&a.includes(".")){i=a.substring(0,a.lastIndexOf("."));let c=this.__node.graph.get(a.substring(0,i));s=a.lastIndexOf(".")+1,c&&typeof c[t]=="function"&&(a=(...u)=>c[s](...u))}else d.__operator&&(a=d.__operator,s="__operator");return a};if(t){if((!this.__node.localState||!this.__node.localState[t])&&this.__addLocalState(this,t),typeof e=="string"){if(o=this.__node.tag+"."+e,s=e,i){if(this.__node.graph?.get(i)){let c=this.__node.graph?.get(i);if(typeof c[e]=="function"){let u=c[e];e=(...h)=>{u(...h)}}else{let u=e;e=g=>{c[u]=g}}}}else if(typeof this[e]=="function"){let c=this[e];e=(...u)=>{c(...u)}}else this.__node.graph?.get(e)&&(e=f(e));if(typeof e!="function")return}let a,d=n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t;return typeof e=="function"&&!e?.__node?a=l(d,(c,u)=>u||c,e):e?.__node&&(a=l(d,(c,u)=>u||c.__node.unique,(...c)=>{e.__operator&&e.__operator(...c)})),a}else{if(typeof e=="string"&&(o=e,i||(i=e),this.__node.graph.get(e)&&(e=this.__node.graph.get(e)),s="__operator",typeof e!="object"))return;let a,d=n?this.__node.unique+"input":this.__node.unique;return typeof e=="function"&&!e?.__node?a=l(d,(c,u)=>u||c,e):e?.__node&&(a=l(d,(c,u)=>u||c.__node.unique,(...c)=>{e.__operator&&e.__operator(...c)})),a}};__unsubscribe=(e,t,n)=>t?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t,e):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,e);__setOperator=e=>{e=e.bind(this),this.__args&&this.__node.graph&&(e=A(e,this.__args,this.__node.graph).__callback);let t=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[t]&&this.__node.state.setValue(t,n);let i=e(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof i?.then=="function"?i.then(s=>{s!==void 0&&this.__node.state.setValue(this.__node.unique,s)}).catch(console.error):i!==void 0&&this.__node.state.setValue(this.__node.unique,i)),i},this.__parent instanceof _&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),i=()=>{this.__parent?.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(i),this.__subscribedToParent=!0}return this.__call=(...n)=>this.__operator(...n),this.__operator};__addLocalState=(e,t)=>{if(!e)return;this.__node.localState||(this.__node.localState={});let n=this.__node.localState,i=(s,r)=>{let o=this.__node.unique+"."+r,l=`${o}input`,f,a,d,c;if(typeof s[r]=="function"&&r!=="__operator")this.__props?.[r]?d=this.__props:d=n,f=()=>d[r],a=u=>{this.__props?.[r]||(u=u.bind(this)),d[r]=(...h)=>{this.__node.state.triggers[l]&&this.__node.state.setValue(l,h);let g=u(...h);return this.__node.state.triggers[o]&&(typeof g?.then=="function"?g.then(b=>{this.__node.state.triggerEvent(o,b)}).catch(console.error):this.__node.state.triggerEvent(o,g)),g}},n[r]=s[r].bind(this),c={get:f,set:a,enumerable:!0,configurable:!0};else{let u,h,g;this.__props?.[r]?g=this.__props:g=n,u=()=>g[r],h=b=>{g[r]=b,this.__node.state.triggers[o]&&this.__node.state.triggerEvent(o,b)},n[r]=s[r],c={get:u,set:h,enumerable:!0,configurable:!0}}if(Object.defineProperty(s,r,c),typeof this.__node.initial=="object"){let u=Object.getOwnPropertyDescriptor(this.__node.initial,r);(u===void 0||u?.configurable)&&Object.defineProperty(this.__node.initial,r,c)}};if(t)i(e,t);else for(let s in e)i(e,s)};__proxyObject=e=>{let t=q(e);for(let n of t){let i={get:()=>e[n],set:s=>{e[n]=s},enumerable:!0,configurable:!0};if(Object.defineProperty(this,n,i),typeof this.__node.initial=="object"){let s=Object.getOwnPropertyDescriptor(this.__node.initial,n);(s===void 0||s?.configurable)&&Object.defineProperty(this.__node.initial,n,i)}}};__addOnconnected(e){e=e.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){e=e.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=n=>{n(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=n=>{n(this)};this.__ondisconnected.forEach(t)}}},y=class _{__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:F,roots:{}};constructor(e){this.init(e)}init=e=>{if(e){let t=Object.assign({},e);delete t.roots,N(this.__node,t),e.roots&&this.load(e.roots)}};load=(e,t=!1)=>{function n(r,o,l=!0,f=!0){if(f){r||(r={});for(let a in o)!a.startsWith("__")&&o[a]&&typeof o[a]=="object"?(r[a]=o[a],o[a]?.__children&&n({},o[a].__children,!1,!1)):typeof o[a]=="function"&&(r[a]=o[a]);n(r,o,!0,!1)}else if(o?.__children&&!l)o.__children?.constructor.name==="Object"?r.__children?.constructor.name==="Object"?r.__children=n(r.__children,o.__children,!0,!1):r.__children=n({},o.__children,!0,!1):r.__children=o.__children;else if(l)for(let a in o)!a.startsWith("__")&&o[a]&&typeof o[a]=="object"?(r[a]=Object.assign({},o[a]),o[a]?.__children&&(r[a].__children=n({},o[a].__children,!1,!1))):typeof o[a]=="function"&&(r[a]=o[a]);return r}this.__node.roots=n(this.__node.roots?this.__node.roots:{},e);let i=Object.assign({},e);i.__node&&delete i.__node;let s=this.recursiveSet(i,this,void 0,e,t);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let r=new p(e,this,this);this.set(r.__node.tag,r),this.runLoaders(r,this,e,e.__node.tag),r.__listeners&&(s[r.__node.tag]=r.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(s),i};setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders);runLoaders=(e,t,n,i)=>{for(let s in this.__node.loaders)typeof this.__node.loaders[s]=="object"?(this.__node.loaders[s].init&&this.__node.loaders[s](e,t,this,this.__node.roots,n,i),this.__node.loaders[s].connected&&e.__addOnconnected(this.__node.loaders[s].connect),this.__node.loaders[s].disconnected&&e.__addOndisconnected(this.__node.loaders[s].disconnect)):typeof this.__node.loaders[s]=="function"&&this.__node.loaders[s](e,t,this,this.__node.roots,n,i)};add=(e,t,n=!0)=>{let i={};typeof t=="string"&&(t=this.get(t));let s;if(typeof e=="function"?P(e)?e.prototype instanceof p?(e=e.prototype.constructor(e,t,this),s=!0):e=new e:e={__operator:e}:typeof e=="string"&&(e=this.__node.roots[e]),!e)return;if(!s){let l=Object.getOwnPropertyNames(e),f=Object.getOwnPropertyNames(Object.getPrototypeOf(e));l.push(...f),l=l.filter(d=>!O.includes(d));let a={};for(let d of l)a[d]=e[d];e=a}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&this.get(e.__node.tag))if(n)this.remove(e.__node.tag,!0);else return;else if(e.__node.tag&&this.get(e.__node.tag))return this.get(e.__node.tag);let r,o=N({},e,2);if(s?r=e:r=new p(e,t,this),this.set(r.__node.tag,r),this.runLoaders(r,t,e,r.__node.tag),this.__node.roots[r.__node.tag]=o,r.__children&&(r.__children=Object.assign({},r.__children),this.recursiveSet(r.__children,r,i,r.__children)),r.__listeners){i[r.__node.tag]=Object.assign({},r.__listeners);for(let l in r.__listeners){let f=r.__listeners[l];r[l]&&(delete i[r.__node.tag][l],i[r.__node.tag][r.__node.tag+"."+l]=f),typeof f=="string"&&(r.__children?.[f]?i[r.__node.tag][l]=r.__node.tag+"."+f:t instanceof p&&(t.__node.tag===f||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===f)&&(i[r.__node.tag][l]=t.__node.tag))}}return this.setListeners(i),r.__callConnected(),r};recursiveSet=(e,t,n={},i,s=!1)=>{let r=Object.getOwnPropertyNames(i).filter(l=>!O.includes(l)),o=Object.getOwnPropertyNames(Object.getPrototypeOf(i)).filter(l=>!O.includes(l));r.push(...o);for(let l of r){if(l.includes("__"))continue;let f=i[l];if(Array.isArray(f))continue;let a;if(typeof f=="function"?P(f)?(f=new f,f instanceof p&&(f=f.prototype.constructor(f,t,this),a=!0)):f={__operator:f}:typeof f=="string"?this.__node.nodes.get(f)?f=this.__node.nodes.get(f):f=this.__node.roots[f]:typeof f=="boolean"&&(this.__node.nodes.get(l)?f=this.__node.nodes.get(l):f=this.__node.roots[l]),f&&typeof f=="object"){if(!a&&!(f instanceof p)){let h=Object.getOwnPropertyNames(f).filter(m=>!O.includes(m)),g=Object.getOwnPropertyNames(Object.getPrototypeOf(f)).filter(m=>!O.includes(m));g.splice(g.indexOf("constructor"),1),h.push(...g);let b={};for(let m of h)b[m]=f[m];f=b}if(f.__node||(f.__node={}),f.__node.tag||(f.__node.tag=l),f.__node.initial||(f.__node.initial=e[l]),s&&this.get(f.__node.tag))this.remove(f.__node.tag,!0);else if(this.get(f.__node.tag)&&!(!(t instanceof _)&&t?.__node)||t?.__node&&this.get(t.__node.tag+"."+f.__node.tag))continue;let d,c=!1,u=N({},f,2);if(a||f instanceof p?d=f:(d=new p(f,t,this),c=!0),!c&&f instanceof p&&!a&&t instanceof p){let h=this.subscribe(t.__node.tag,d.__node.tag),g=b=>{this.unsubscribe(t.__node.tag,h)};d.__addOndisconnected(g)}else if(d){if(this.set(d.__node.tag,d),this.runLoaders(d,t,e[l],l),e[l]=d,this.__node.roots[d.__node.tag]=u,d.__children&&(d.__children=Object.assign({},d.__children),this.recursiveSet(d.__children,d,n,d.__children)),d.__listeners){n[d.__node.tag]=Object.assign({},d.__listeners);for(let h in d.__listeners){let g=d.__listeners[h],b=h;d[h]&&(delete n[d.__node.tag][h],b=d.__node.tag+"."+h,n[d.__node.tag][b]=g),typeof g=="string"&&(d.__children?.[g]?n[d.__node.tag][b]=d.__node.tag+"."+g:t instanceof p&&(t.__node.tag===g||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===g)&&(n[d.__node.tag][b]=t.__node.tag))}}d.__callConnected()}}}return n};remove=(e,t=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof p){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let n=i=>{for(let s in i)this.unsubscribe(i[s]),this.delete(i[s].__node.tag),delete this.__node.roots[i[s].__node.tag],this.delete(s),delete this.__node.roots[s],i[s].__node.tag=i[s].__node.tag.substring(i[s].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(i[s]),i[s].__callDisconnected(),i[s].__children&&n(i[s].__children)};e.__children&&n(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e?.__node.graph&&(e.__node.graph=void 0),e};run=(e,...t)=>{if(typeof e=="string"){let n=this.get(e);if(!n&&e.includes(".")){if(n=this.get(e.substring(0,e.lastIndexOf("."))),typeof n?.[e.substring(e.lastIndexOf(".")+1)]=="function")return n[e.substring(e.lastIndexOf(".")+1)](...t)}else if(n?.__operator)return n.__operator(...t)}if(e?.__operator)return e?.__operator(...t)};setListeners=e=>{for(let t in e){let n=this.get(t);if(typeof e[t]=="object")for(let i in e[t]){let s=this.get(i),r;if(typeof e[t][i]!="object")e[t][i]={__callback:e[t][i]};else if(!e[t][i].__callback)for(let o in e[t][i]){typeof e[t][i][o]!="object"&&(e[t][i][o]={__callback:e[t][i][o]},n.__operator&&(e[t][i][o].__callback===!0||typeof e[t][i][o].__callback>"u")&&(e[t][i][o].__callback=n.__operator));let l=this.get(o);if(l)r=this.subscribe(l,e[t][i][o].__callback,e[t][i][o].__args,void 0,e[t][i][o].subInput,t);else{let f=i.substring(0,i.lastIndexOf("."));if(l=this.get(f),l){let a=i.substring(i.lastIndexOf(".")+1);r=this.subscribe(l,e[t][i][o].__callback,e[t][i][o].__args,a,e[t][i][o].subInput,t)}}}if("__callback"in e[t][i])if(n&&((e[t][i].__callback===!0||typeof e[t][i].__callback>"u")&&(e[t][i].__callback=n.__operator),typeof e[t][i].__callback=="function"&&(e[t][i].__callback=e[t][i].__callback.bind(n))),s)r=this.subscribe(s,e[t][i].__callback,e[t][i].__args,void 0,e[t][i].subInput,t);else{let o=i.substring(0,i.lastIndexOf("."));s=this.get(o),s&&(r=this.subscribe(s,e[t][i].__callback,e[t][i].__args,i.substring(i.lastIndexOf(".")+1),e[t][i].subInput,t))}}}};clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let n in e.__listeners){if(t&&n!==t||typeof e.__listeners[n]?.sub!="number")continue;let i=this.get(n);if(i)if(typeof!e.__listeners[n]?.__callback=="number")for(let s in e.__listeners[n])e.__listeners[n][s]?.sub&&(this.unsubscribe(i,e.__listeners[n][s].sub,void 0,e.__listeners[n][s].subInput),e.__listeners[n][s].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n].sub,void 0,e.__listeners[n].subInput),e.__listeners[n].sub=void 0);else if(i=this.get(n.substring(0,n.lastIndexOf("."))),i)if(typeof e.__listeners[n]=="object"&&!e.__listeners[n]?.__callback)for(let s in e.__listeners[n])typeof e.__listeners[n][s]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n][s].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n][s].subInput),e.__listeners[n][s].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(i,e.__listeners[n].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n].subInput),e.__listeners[n].sub=void 0)}};get=e=>this.__node.nodes.get(e);getByUnique=e=>Array.from(this.__node.nodes.values()).find(t=>{if(t.__node.unique===e)return!0});set=(e,t)=>this.__node.nodes.set(e,t);delete=e=>this.__node.nodes.delete(e);list=()=>Array.from(this.__node.nodes.keys());getListener=(e,t,n)=>{let i=this.get(e);if(i){let s=i.__node.unique;return t&&(s+="."+t),this.__node.state.getEvent(s,n)}};getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof p){let n;if(t)n=Object.assign({},this.__node.roots[e.__node.tag]);else{n=Object.assign({},e);for(let i in n)i.includes("__")&&delete n[i]}}};subscribe=(e,t,n,i,s,r,o)=>{let l=e;typeof e=="string"&&(l=this.get(e),!l&&e.includes(".")&&(l=this.get(e.substring(0,e.lastIndexOf("."))),i=e.substring(e.lastIndexOf(".")+1))),r instanceof p&&(r=r.__node.tag);let f;if(typeof t=="string"){f=t;let d=c=>{if(this.get(c)?.__operator){let u=this.get(c);r=c,c=function(...h){return u.__operator(...h)}}else if(c.includes(".")){r=c.substring(0,c.lastIndexOf("."));let u=this.get(r),h=c.substring(c.lastIndexOf(".")+1);o=h,typeof u[h]=="function"?u[h]instanceof p?c=u[h]:c=function(...g){return u[h](...g)}:c=function(g){return u[h]=g,u[h]}}return c};if(r){let c=this.get(r);typeof c?.[t]=="function"?(o=t,t=function(...u){return c[i](...u)}):c?.[i]?(o=i,c[i]instanceof p?t=c[i]:t=function(u){return c[i]=u,c[i]}):t=d(t)}else t=d(t)}let a;if(l instanceof p){let d=()=>{a=l.__subscribe(t,i,s,r,o,n,f);let c=()=>{a!==void 0&&l.__unsubscribe(a,i,s),a=void 0};l.__addOndisconnected(()=>{c(),l.__addOnconnected(()=>{a===void 0&&l.__node.graph.__node.tag===this.__node.tag&&d()})}),typeof t=="string"&&this.get(t)&&(t=this.get(t)),t instanceof p&&t.__addOndisconnected(()=>{c()})};d()}else if(typeof e=="string"){let d=this.get(e);if(d){if(t instanceof p&&t.__operator){let c=()=>{a=d.__subscribe(t.__operator,i,s,r,o,n,f);let u=()=>{a!==void 0&&d.__unsubscribe(a,i,s)};d.__addOndisconnected(()=>{u(),d.__addOnconnected(()=>{a===void 0&&d.__node.graph.__node.tag===this.__node.tag&&c()})}),t.__addOndisconnected(u)};c()}else if(typeof t=="function"||typeof t=="string"){let c=()=>{a=d.__subscribe(t,i,s,r,o,n,f);let u=()=>{a!==void 0&&d.__unsubscribe(a,i,s),a=void 0};d.__addOndisconnected(()=>{u(),d.__addOnconnected(()=>{a===void 0&&d.__node.graph.__node.tag===this.__node.tag&&c()})}),typeof t=="string"&&this.get(t)&&this.get(t).__addOndisconnected(u)};c()}}else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&!t?.__node&&(a=this.__node.state.subscribeEvent(e,t))}return a};unsubscribe=(e,t,n,i)=>e instanceof p?e.__unsubscribe(t,n,i):this.get(e)?.__unsubscribe(t,n,i);setState=e=>{this.__node.state.setState(e)}};function N(_,e,t=1/0,n=0){for(let i in e)e[i]?.constructor.name==="Object"&&n<t?(n++,_[i]?.constructor.name==="Object"?N(_[i],e[i],t,n):_[i]=N({},e[i],t,n)):_[i]=e[i];return _}function q(_){var e=[],t=_;do{var n=Object.getOwnPropertyNames(t);let i=function(s){e.indexOf(s)===-1&&e.push(s)};n.forEach(i)}while(t=Object.getPrototypeOf(t));return e}function W(_){let e=q(_),t={};for(let n of e)t[n]=_[n];return t}function P(_){return L(_)==="class"}function L(_){return typeof _=="function"?_.prototype?Object.getOwnPropertyDescriptor(_,"prototype")?.writable?"function":"class":_.constructor.name==="AsyncFunction"?"async":"arrow":""}var j=(_,e)=>{if(e.get(_)?.__operator){let t=e.get(_);return(...n)=>{t.__operator(...n)}}else if(_.includes(".")){let t=_.split("."),n=t.pop(),i=t.join("."),s=e.get(i);return typeof e.get(i)?.[n]=="function"?(...r)=>s[n](...r):()=>s[n]}else if(e.get(_)){let t=e.get(_);return()=>t}else{let t=_;return()=>t}},A=(_,e,t)=>{let n=[],i=(r,o)=>{if(r==="__output"||r==="__input"||r==="__callback")n[o]={__callback:l=>l,__args:void 0,idx:o};else if(typeof r=="string")n[o]={__callback:j(r,t),__args:void 0,idx:o};else if(typeof r=="function"){let l=r;n[o]={__callback:(...f)=>l(...f),__args:void 0,idx:o}}else if(typeof r=="object"&&(r.__input||r.__callback)){let l=function(f){let a=f.__input?f.__input:f.__callback;if(typeof f.__input=="string"&&(a={__callback:j(f.__input,t),__args:void 0,idx:o}),f.__args){let d=A(a,f.__args,t);a={__callback:d.__callback,__args:d.__args,idx:o}}else a={__callback:a,__args:void 0,idx:o};if(f.__output){let d=f.__output;if(typeof f.__output=="string"?d={__callback:j(d,t),__args:void 0,idx:o}:typeof r.__output=="object"&&(d=l(d)),typeof d?.__callback=="function"){let c=a.__callback,u=d.__callback;a={__callback:(...h)=>u(c(...h)),__args:d.__args,idx:o}}}return a};n[o]=l(r)}else{let l=r;n[o]={__callback:()=>l,__args:void 0,idx:o}}};e.forEach(i),typeof _=="string"&&(_={__callback:j(_,t),__args:void 0});let s=typeof _=="function"?_:_.__callback;return _=function(...r){let o=f=>f.__callback(...r);return s(...n.map(o))},{__callback:_,__args:n}},O=Object.getOwnPropertyNames(Object.getPrototypeOf({}));var S=(_,e,t)=>{_.__node.backward&&e instanceof p&&t.setListeners({[e.__node.tag]:{[_.__node.tag]:e}})},I=(_,e,t)=>{if(_.__operator){let n=Math.random();if(_.__node.loops||(_.__node.loops={}),typeof _.__node.delay=="number"){let i=_.__operator;_.__setOperator((...s)=>new Promise((r,o)=>{_.__node.loops[n]=setTimeout(async()=>{r(await i(...s))},_.__node.delay)}))}else if(_.__node.frame===!0){let i=_.__operator;_.__setOperator((...s)=>new Promise((r,o)=>{_.__node.loops[n]=requestAnimationFrame(async()=>{r(await i(...s))})}))}if(typeof _.__node.repeat=="number"||typeof _.__node.recursive=="number"){let i=_.__operator;_.__setOperator(async(...s)=>{let r=_.__node.repeat?_.__node.repeat:_.__node.recursive,o,l=async(f,...a)=>{for(;f>0;){if(_.__node.delay||_.__node.frame){i(...a).then(async d=>{_.__node.recursive?await l(f,d):await l(f,...a)});break}else o=await i(...s);f--}};return await l(r,...s),o})}if(_.__node.loop&&typeof _.__node.loop=="number"){let i=_.__operator,s=_.__node.loop;_.__setOperator((...o)=>{if("looping"in _.__node||(_.__node.looping=!0),_.__node.looping){let l=performance.now();i(...o),_.__node.loops[n]=setTimeout(()=>{let a=performance.now()-l-_.__node.loop;a>0?s=_.__node.loop-a:s=_.__node.loop,s<=0&&(s=_.__node.loop),_.__operator(...o)},s)}}),_.__node.looping&&_.__operator();let r=o=>{o.__node.looping&&(o.__node.looping=!1),o.__node.loops[n]&&(clearTimeout(o.__node.loops[n]),cancelAnimationFrame(o.__node.loops[n]))};_.__addOndisconnected(r)}}},v=(_,e,t)=>{if(_.__node.animate===!0||_.__animation){let n=_.__operator;_.__setOperator((...s)=>{"animating"in _.__node||(_.__node.animating=!0),_.__node.animating&&(typeof _.__animation=="function"?_.__animation(...s):n(...s),_.__node.animationFrame=requestAnimationFrame(()=>{_.__operator(...s)}))}),(_.__node.animating||(!("animating"in _.__node)||_.__node.animating)&&_.__animation)&&setTimeout(()=>{_.__node.animationFrame=requestAnimationFrame(_.__operator)},10);let i=s=>{s.__node.animating&&(s.__node.animating=!1),s.__node.animationFrame&&cancelAnimationFrame(s.__node.animationFrame)};_.__addOndisconnected(i)}},M=(_,e,t)=>{if(typeof _.__branch=="object"&&_.__operator&&!_.__branchApplied){let n=_.__operator;_.__branchApplied=!0,_.__operator=(...i)=>{let s=n(...i);for(let r in _.__branch){let o=()=>{typeof _.__branch[r].then=="function"?_.__branch[r].then(s):_.__branch[r].then instanceof p&&_.__branch[r].then.__operator?_.__branch[r].then.__operator(s):s=_.__branch[r].then};typeof _.__branch[r].if=="function"?_.__branch[r].if(s)==!0&&o():_.__branch[r].if===s&&o()}return s}}if(_.__listeners){for(let n in _.__listeners)if(typeof _.__listeners[n]=="object"&&_.__listeners[n].branch&&!_.__listeners[n].branchApplied){let i=_.__listeners[n].callback;_.__listeners[n].branchApplied=!0,_.__listeners.callback=s=>{let r=()=>{typeof _.__listeners[n].branch.then=="function"?s=_.__listeners[n].branch.then(s):_.__listeners[n].branch.then instanceof p&&_.__listeners[n].branch.then.__operator?s=_.__listeners[n].branch.then.__operator(s):s=_.__listeners[n].branch.then};return typeof _.__listeners[n].branch.if=="function"?_.__listeners[n].branch.if(s)&&r():_.__listeners[n].branch.if===s&&r(),i(s)}}}},T=(_,e,t)=>{if(_.__listeners)for(let n in _.__listeners)typeof _.__listeners[n]=="object"&&_.__listeners[n].oncreate&&_.__listeners[n].callback(_.__listeners[n].oncreate)},$=(_,e,t)=>{if(_.__listeners)for(let n in _.__listeners)typeof _.__listeners[n]=="object"&&typeof _.__listeners[n].binding=="object"&&(_.__listeners.callback=_.__listeners.callback.bind(_.__listeners[n].binding))},R=(_,e,t)=>{if(_.__listeners){for(let n in _.__listeners)if(typeof _.__listeners[n]=="object"&&typeof _.__listeners[n].transform=="function"&&!_.__listeners[n].transformApplied){let i=_.__listeners[n].callback;_.__listeners[n].transformApplied=!0,_.__listeners.callback=s=>(s=_.__listeners[n].transform(s),i(s))}}},C=(_,e,t)=>{_.post&&!_.__operator?_.__setOperator(_.post):!_.__operator&&typeof _.get=="function"&&_.__setOperator(_.get),!_.get&&_.__operator,_.aliases&&_.aliases.forEach(n=>{t.set(n,_);let i=s=>{t.__node.nodes.delete(n)};_.__addOndisconnected(i)}),typeof t.__node.roots?.[_.__node.tag]=="object"&&_.get&&(t.__node.roots[_.__node.tag].get=_.get)},J={backprop:S,loop:I,animate:v,branching:M,triggerListenerOncreate:T,bindListener:$,transformListenerResult:R,substitute__operator:C};})();
