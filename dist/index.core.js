(()=>{var y=class{constructor(e){this.pushToState={};this.data={};this.triggers={};this.setState=e=>{Object.assign(this.data,e);let t=Object.getOwnPropertyNames(e);for(let _ of t)if(this.triggers[_]){let n=s=>{s.onchange(this.data[_])};this.triggers[_].forEach(n)}return this.data};this.setValue=(e,t)=>{this.data[e]=t,this.triggerEvent(e,t)};this.triggerEvent=(e,t)=>{if(this.triggers[e]){let _=n=>{n.onchange(t)};this.triggers[e].forEach(_)}};this.subscribeEvent=(e,t,_,n)=>{if(e){_&&n&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>_[n],set:o=>{_[n]=o},enumerable:!0,configurable:!0}),this.triggers[e]||(this.triggers[e]=[]);let s=this.triggers[e].length;return this.triggers[e].push({sub:s,onchange:t}),this.triggers[e].length-1}else return};this.unsubscribeEvent=(e,t)=>{let _=this.triggers[e];if(_)if(!t)delete this.triggers[e],delete this.data[e];else{let n,s=_.find((o,r)=>{if(o.sub===n)return n=r,!0});return s&&_.splice(n,1),Object.keys(_).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(s),!0}};this.subscribeEventOnce=(e,t)=>{let _,n=s=>{t(s),this.unsubscribeEvent(e,_)};_=this.subscribeEvent(e,n)};this.getEvent=(e,t)=>{for(let _ in this.triggers[e])if(this.triggers[e][_].sub===t)return this.triggers[e][_]};this.getSnapshot=()=>{let e={};for(let t in this.data)e[t]=this.data[t]};typeof e=="object"&&(this.data=e)}};var m=new y,h=class{constructor(e,t,_){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:m};this.__setProperties=(e,t,_)=>{if((()=>{let s=e;typeof e=="function"?b(e)?e=new e:e={__operator:e,__node:{forward:!0,tag:e.name}}:typeof e=="string"&&_?.get(e)&&(e=_.get(e)),e.__node.initial||(e.__node.initial=s)})(),typeof e=="object"){let s=()=>{e.__node?.state&&(this.__node.state=e.__node.state)},o=()=>{e.__props&&(typeof e.__props=="function"&&(e.__props=new e.__props),typeof e.__props=="object"&&this.__proxyObject(e.__props))},r=()=>{e.__node.tag||(e.__operator?.name?e.__node.tag=e.__operator.name:e.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},f=()=>{typeof e.__node=="string"?_?.get(e.__node.tag)?e=_.get(e.__node.tag):e.__node={}:e.__node||(e.__node={}),_&&(e.__node.graph=_),e instanceof g&&(e.__node.source=e)},a=()=>{if(!e.__parent&&t&&(e.__parent=t),t?.__node&&!(t instanceof g||e instanceof g)&&(e.__node.tag=t.__node.tag+"."+e.__node.tag),t instanceof g&&e instanceof g&&(e.__node.loaders&&Object.assign(t.__node.loaders?t.__node.loaders:{},e.__node.loaders),t.__node.mapGraphs)){e.__node.nodes.forEach(u=>{t.set(e.__node.tag+"."+u.__node.tag,u)});let d=()=>{e.__node.nodes.forEach(u=>{t.__node.nodes.delete(e.__node.tag+"."+u.__node.tag)})};this.__addOndisconnected(d)}},c=()=>{if(typeof e.default=="function"&&!e.__operator&&(e.__operator=e.default),e.__operator){if(typeof e.__operator=="string"&&_){let d=_.get(e.__operator);d&&(e.__operator=d.__operator),!e.__node.tag&&e.__operator.name&&(e.__node.tag=e.__operator.name)}typeof e.__operator=="function"&&(e.__operator=this.__setOperator(e.__operator)),e.default&&(e.default=e.__operator)}},l=()=>{e.__node=Object.assign(this.__node,e.__node);let d=Object.getOwnPropertyNames(e);for(let u of d)this[u]=e[u]};s(),r(),o(),f(),a(),l(),c()}};this.__subscribe=(e,t,_,n,s)=>{let o=(f,a=(l,d)=>l,c=e)=>{let l=this.__node.state.subscribeEvent(f,c,this,t),d=this.__node.state.getEvent(f,l);return d.source=this.__node.tag,t&&(d.key=t),d.target=a(e),n&&(d.bound=n),l},r=f=>{if(!this.__node.graph.get(f)&&f.includes(".")){let c=this.__node.graph.get(f.substring(0,f.lastIndexOf("."))),l=f.substring(f.lastIndexOf(".")+1);c&&typeof c[l]=="function"&&(f=(...d)=>c[l](...d))}};if(t){if((!this.__node.localState||!this.__node.localState[t])&&this.__addLocalState(this,t),typeof e=="string"){if(s){if(this.__node.graph?.get(s)){let c=this.__node.graph?.get(s);if(typeof c[e]=="function"){let l=c[e];e=(...d)=>{l(...d)}}else{let l=e;e=u=>{c[l]=u}}}}else if(typeof this[e]=="function"){let c=this[e];e=(...l)=>{c(...l)}}else this.__node.graph?.get(e)&&r(e);if(typeof e!="function")return}let f,a=_?this.__node.unique+"."+t+"input":this.__node.unique+"."+t;return typeof e=="function"?f=o(a):e?.__node&&(f=o(a,(c,l)=>l||c.__node.unique,(...c)=>{e.__operator&&e.__operator(...c)})),f}else{if(typeof e=="string"&&(this.__node.graph.get(e)&&(e=this.__node.graph.get(e)),typeof e!="object"))return;let f,a=_?this.__node.unique+"input":this.__node.unique;return typeof e=="function"?f=o(a):e?.__node&&(f=o(a,(c,l)=>l||c.__node.unique,(...c)=>{e.__operator&&e.__operator(...c)})),f}};this.__unsubscribe=(e,t,_)=>t?this.__node.state.unsubscribeEvent(_?this.__node.unique+"."+t+"input":this.__node.unique+"."+t,e):this.__node.state.unsubscribeEvent(_?this.__node.unique+"input":this.__node.unique,e);this.__setOperator=e=>{e=e.bind(this),this.__args&&this.__node.graph&&(e=O(e,this.__args,this.__node.graph));let t=`${this.__node.unique}input`;if(this.__operator=(..._)=>{this.__node.state.triggers[t]&&this.__node.state.setValue(t,_);let n=e(..._);return this.__node.state.triggers[this.__node.unique]&&(typeof n?.then=="function"?n.then(s=>{s!==void 0&&this.__node.state.setValue(this.__node.unique,s)}).catch(console.error):n!==void 0&&this.__node.state.setValue(this.__node.unique,n)),n},this.__parent instanceof h&&!this.__subscribedToParent&&this.__parent.__operator){let _=this.__parent.__subscribe(this),n=()=>{this.__parent?.__unsubscribe(_),delete this.__subscribedToParent};this.__addOndisconnected(n),this.__subscribedToParent=!0}return this.__operator};this.__addLocalState=(e,t)=>{if(!e)return;this.__node.localState||(this.__node.localState={});let _=this.__node.localState,n=(s,o)=>{let r=this.__node.unique+"."+o,f=`${r}input`;if(typeof s[o]=="function"&&o!=="__operator"){let a=s[o].bind(this);s[o]=(...c)=>{this.__node.state.triggers[f]&&this.__node.state.setValue(f,c);let l=a(...c);return this.__node.state.triggers[r]&&(typeof l?.then=="function"?l.then(d=>{this.__node.state.triggerEvent(r,d)}).catch(console.error):this.__node.state.triggerEvent(r,l)),l}}else{let a,c;this.__props?.[o]?(a=()=>this.__props[o],c=d=>{this.__props[o]=d,this.__node.state.triggers[r]&&this.__node.state.triggerEvent(r,d)}):(_[o]=s[o],a=()=>_[o],c=d=>{_[o]=d,this.__node.state.triggers[r]&&this.__node.state.triggerEvent(r,d)});let l={get:a,set:c,enumerable:!0,configurable:!0};if(Object.defineProperty(s,o,l),typeof this.__node.initial=="object"){let d=Object.getOwnPropertyDescriptor(this.__node.initial,o);(d===void 0||d?.configurable)&&Object.defineProperty(this.__node.initial,o,l)}}};if(t)n(e,t);else for(let s in e)n(e,s)};this.__proxyObject=e=>{let t=G(e);for(let _ of t)typeof e[_]=="function"?this[_]=(...n)=>e[_](...n):Object.defineProperty(this,_,{get:()=>e[_],set:s=>{e[_]=s},enumerable:!0,configurable:!0})};this.__setProperties(e,t,_)}__addOnconnected(e){Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=_=>{_(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=_=>{_(this)};this.__ondisconnected.forEach(t)}}},g=class{constructor(e){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:m,roots:{}};this.init=e=>{if(e){let t=Object.assign({},e);delete t.roots,p(this.__node,t),e.roots&&this.load(e.roots)}};this.load=e=>{function t(s,o,r=!0,f=!0){if(f&&(s?Object.assign(s,o):s=Object.assign({},o),t(s,o,!0,!1)),o.__children&&!r)o.__children?.constructor.name==="Object"?s.__children?.constructor.name==="Object"?t(s.__children,o.__children,!0,!1):s.__children=t({},o.__children,!0,!1):s.__children=o.__children;else if(r)for(let a in o)s[a]=Object.assign({},o[a]),o[a].__children&&t({},o[a].__children,!1,!1);return s}this.__node.roots=t(this.__node.roots?this.__node.roots:{},e);let _=Object.assign({},e);_.__node&&delete _.__node;let n=this.recursiveSet(_,this,void 0,e);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let s=new h(e,this,this);this.set(s.__node.tag,s),this.runLoaders(s,this,e,e.__node.tag),s.__listeners&&(n[s.__node.tag]=s.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(n),_};this.setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders);this.runLoaders=(e,t,_,n)=>{for(let s in this.__node.loaders)typeof this.__node.loaders[s]=="object"?(this.__node.loaders[s].init&&this.__node.loaders[s](e,t,this,this.__node.roots,_,n),this.__node.loaders[s].connected&&e.__addOnconnected(this.__node.loaders[s].connect),this.__node.loaders[s].disconnected&&e.__addOndisconnected(this.__node.loaders[s].disconnect)):typeof this.__node.loaders[s]=="function"&&this.__node.loaders[s](e,t,this,this.__node.roots,_,n)};this.add=(e,t)=>{let _={};typeof t=="string"&&(t=this.get(t));let n;if(typeof e=="function"?b(e)?e.prototype instanceof h?(e=e.prototype.constructor(e,t,this),n=!0):e=new e:e={__operator:e}:typeof e=="string"&&(e=this.__node.roots[e]),!!e){if(!n){let s=Object.getOwnPropertyNames(e),o={};for(let r of s)o[r]=e[r];e=o}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&(!e?.__node?.tag||!this.get(e.__node.tag))){let s;return n?s=e:s=new h(e,t,this),this.set(s.__node.tag,s),this.runLoaders(s,t,e,s.__node.tag),this.__node.roots[s.__node.tag]=e,s.__listeners&&(_[s.__node.tag]=s.__listeners),s.__children&&(s.__children=Object.assign({},s.__children),this.recursiveSet(s.__children,s,_,s.__children)),this.setListeners(_),s.__callConnected(),s}}};this.recursiveSet=(e,t,_={},n)=>{let s=Object.getOwnPropertyNames(n);for(let o of s){if(o.includes("__"))continue;let r=n[o];if(Array.isArray(r))continue;let f;if(typeof r=="function"?b(r)?(r=new r,r instanceof h&&(r=r.prototype.constructor(r,t,this),f=!0)):r={__operator:r}:typeof r=="string"?this.__node.nodes.get(r)?r=this.__node.nodes.get(r):r=this.__node.roots[r]:typeof r=="boolean"&&(this.__node.nodes.get(o)?r=this.__node.nodes.get(o):r=this.__node.roots[o]),typeof r=="object"){if(!f&&!(r instanceof h)){let c=Object.getOwnPropertyNames(r),l={};for(let d of c)l[d]=r[d];r=l}if(r.__node||(r.__node={}),r.__node.tag||(r.__node.tag=o),r.__node.initial||(r.__node.initial=e[o]),this.get(r.__node.tag)&&!(!(t instanceof g)&&t?.__node)||t?.__node&&this.get(t.__node.tag+"."+r.__node.tag))continue;let a;if(f||r instanceof h?a=r:a=new h(r,t,this),r instanceof h&&!f&&t instanceof h){let c=this.subscribe(t.__node.tag,a.__node.tag),l=d=>{this.unsubscribe(t.__node.tag,c)};a.__addOndisconnected(l)}else this.set(a.__node.tag,a),this.runLoaders(a,t,e[o],o),e[o]=a,this.__node.roots[a.__node.tag]=r,a.__listeners&&(_[a.__node.tag]=a.__listeners),a.__children&&(a.__children=Object.assign({},a.__children),this.recursiveSet(a.__children,a,_,a.__children)),a.__callConnected()}}return _};this.remove=(e,t=!0)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof h){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let _=n=>{for(let s in n)this.unsubscribe(n[s]),this.delete(n[s].__node.tag),delete this.__node.roots[n[s].__node.tag],this.delete(s),delete this.__node.roots[s],n[s].__node.tag=n[s].__node.tag.substring(n[s].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(n[s]),n[s].__callDisconnected(),n[s].__children&&_(n[s].__children)};e.__children&&_(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e};this.run=(e,...t)=>{if(typeof e=="string"){let _=this.get(e);if(!_&&e.includes(".")){if(_=this.get(e.substring(0,e.lastIndexOf("."))),typeof _?.[e.substring(e.lastIndexOf(".")+1)]=="function")return _[e.substring(e.lastIndexOf(".")+1)](...t)}else if(_?.__operator)return _.__operator(...t)}if(e?.__operator)return e?.__operator(...t)};this.setListeners=e=>{for(let t in e){let _=this.get(t);if(typeof e[t]=="object")for(let n in e[t]){let s=this.get(n),o;if(typeof e[t][n]!="object")e[t][n]={__callback:e[t][n]};else if(!e[t][n].__callback)for(let r in e[t][n]){typeof e[t][n][r]!="object"&&(e[t][n][r]={__callback:e[t][n][r]},(e[t][n][r].__callback===!0||typeof e[t][n][r].__callback>"u")&&(e[t][n][r].__callback=_.__operator));let f=this.get(r);if(f)if(f)o=this.subscribe(f,e[t][n][r].__callback,e[t][n].__args,void 0,e[t][n].inputState,t,n),typeof _.__listeners[n][r]!="object"&&(_.__listeners[n][r]={__callback:e[t][n][r].__callback,inputState:e[t][n][r]?.inputState}),_.__listeners[n][r].sub=o;else{let a=n.substring(0,n.lastIndexOf("."));f=this.get(a),s&&(o=this.subscribe(f,e[t][n][r].__callback,e[t][n][r].__args,n.substring(n.lastIndexOf(".")+1),e[t][n][r].inputState,t,n),typeof _.__listeners[n][r]!="object"&&(_.__listeners[n][r]={__callback:e[t][n][r].__callback,inputState:e[t][n][r]?.inputState}),_.__listeners[n][r].sub=o)}}if("__callback"in e[t][n])if((e[t][n].__callback===!0||typeof e[t][n].__callback>"u")&&(e[t][n].__callback=_.__operator),typeof e[t][n].__callback=="function"&&(e[t][n].__callback=e[t][n].__callback.bind(_)),typeof _.__listeners!="object"&&(_.__listeners={}),s)o=this.subscribe(s,e[t][n].__callback,e[t][n].__args,void 0,e[t][n].inputState,t,n),typeof _.__listeners[n]!="object"&&(_.__listeners[n]={__callback:e[t][n].__callback,inputState:e[t][n]?.inputState}),_.__listeners[n].sub=o;else{let r=n.substring(0,n.lastIndexOf("."));s=this.get(r),s&&(o=this.subscribe(s,e[t][n].__callback,e[t][n].__args,n.substring(n.lastIndexOf(".")+1),e[t][n].inputState,t,n),typeof _.__listeners[n]!="object"&&(_.__listeners[n]={__callback:e[t][n].__callback,inputState:e[t][n]?.inputState}),_.__listeners[n].sub=o)}}}};this.clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let _ in e.__listeners){if(t&&_!==t||typeof e.__listeners[_].sub!="number")continue;let n=this.get(_);if(n)if(e.__listeners[_].__callback)this.unsubscribe(n,e.__listeners[_].sub,void 0,e.__listeners[_].inputState);else for(let s in e.__listeners[_])this.unsubscribe(n,e.__listeners[_][s].sub,void 0,e.__listeners[_][s].inputState);else if(n=this.get(_.substring(0,_.lastIndexOf("."))),n)if(e.__listeners[_].__callback)this.unsubscribe(n,e.__listeners[_].sub,_.substring(_.lastIndexOf(".")+1),e.__listeners[_].inputState);else for(let s in e.__listeners[_])this.unsubscribe(n,e.__listeners[_][s].sub,_.substring(_.lastIndexOf(".")+1),e.__listeners[_][s].inputState);delete e.__listeners[_]}};this.get=e=>this.__node.nodes.get(e);this.set=(e,t)=>this.__node.nodes.set(e,t);this.delete=e=>this.__node.nodes.delete(e);this.getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof h){let _;if(t)_=Object.assign({},this.__node.roots[e.__node.tag]);else{_=Object.assign({},e);for(let n in _)n.includes("__")&&delete _[n]}}};this.subscribe=(e,t,_,n,s,o,r)=>{let f=e;typeof e=="string"&&(f=this.get(e),!f&&e.includes(".")&&(f=this.get(e.substring(0,e.lastIndexOf("."))),n=e.substring(e.lastIndexOf(".")+1)));let a;if(o instanceof h&&(o=o.__node.tag),typeof t=="string"){let c=t;if(o){let l=this.get(o);typeof l?.[t]=="function"?t=function(...d){return l[c](...d)}:t=function(d){return l[c]=d,l[c]}}else if(this.get(t)?.__operator){let l=this.get(t);t=function(...d){return l.__operator(...d)}}else if(t.includes(".")){let l=this.get(t.substring(0,t.lastIndexOf("."))),d=t.substring(t.lastIndexOf(".")+1);typeof l[d]=="function"?t=function(...u){return l[d](...u)}:t=function(u){return l[d]=u,l[d]}}}if((typeof t=="function"||t instanceof h)&&_&&(t instanceof h&&t.__operator&&(t=function(c){return t.__operator(c)}),t=O(t,_,this)),f instanceof h){a=f.__subscribe(t,n,s,o,r);let c=()=>{f.__unsubscribe(a,n,s)};f.__addOndisconnected(c)}else if(typeof e=="string")if(this.get(e))if(t instanceof h&&t.__operator){a=this.get(e).__subscribe(t.__operator,n,s,o,r);let c=()=>{this.get(e).__unsubscribe(a)};t.__addOndisconnected(c)}else(typeof t=="function"||typeof t=="string")&&(a=this.get(e).__subscribe(t,n,s,o,r),this.__node.state.getEvent(this.get(e).__node.unique,a).source=e);else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&(a=this.__node.state.subscribeEvent(e,t));return a};this.unsubscribe=(e,t,_,n)=>e instanceof h?e.__unsubscribe(t,_,n):this.get(e)?.__unsubscribe(t,_,n);this.setState=e=>{this.__node.state.setState(e)};this.init(e)}};function p(i,e){for(let t in e)e[t]?.constructor.name==="Object"&&!Array.isArray(e[t])?i[t]?.constructor.name==="Object"&&!Array.isArray(i[t])?p(i[t],e[t]):i[t]=p({},e[t]):i[t]=e[t];return i}function G(i){var e=[],t=i;do{var _=Object.getOwnPropertyNames(t);let n=function(s){e.indexOf(s)===-1&&e.push(s)};_.forEach(n)}while(t=Object.getPrototypeOf(t));return e}function k(i){let e=G(i),t={};for(let _ of e)t[_]=i[_];return t}function b(i){return typeof i=="function"&&i.hasOwnProperty("prototype")&&!i.hasOwnProperty("arguments")}var O=(i,e,t)=>{let _=[],n=r=>{if(t.get(r)?.__operator){let f=t.get(r);return(...a)=>{f.__operator(...a)}}else if(r.includes(".")){let f=r.split("."),a=f.pop(),c=f.join("."),l=t.get(c);return typeof t.get(c)?.[a]=="function"?(...d)=>l[a](...d):()=>l[a]}else if(t.get(r)){let f=t.get(r);return()=>f}else{let f=r;return()=>f}},s=(r,f)=>{if(r==="__output")_[f]=a=>a;else if(typeof r=="string")_[f]=n(r);else if(typeof r=="function"){let a=r;_[f]=(...c)=>a(...c)}else if(typeof r=="object"&&r.__input){let a=function(c){let l=c.__input;if(typeof c.__input=="string"&&(l=n(c.__input)),c.__args&&(l=O(l,c.__args,t)),c.__output){let d=c.__output;if(typeof c.__output=="string"?d=n(d):typeof r.__output=="object"&&(d=a(d)),typeof d=="function"){let u=l;l=(...N)=>d(u(...N))}}return l};_[f]=a(r)}else{let a=r;_[f]=()=>a}};e.forEach(s),typeof i=="string"&&(i=n(i));let o=i;return i=function(...r){let f=a=>a(...r);return o(..._.map(f))},i};var j=(i,e,t)=>{i.__node.backward&&e instanceof h&&t.setListeners({[e.__node.tag]:{[i.__node.tag]:e}})},x=(i,e,t)=>{if(i.__operator&&!i.__node.looperSet){if(typeof i.__node.delay=="number"){let _=i.__operator;i.__setOperator((...n)=>new Promise((s,o)=>{setTimeout(async()=>{s(await _(...n))},i.__node.delay)}))}else if(i.__node.frame===!0){let _=i.__operator;i.__setOperator((...n)=>new Promise((s,o)=>{requestAnimationFrame(async()=>{s(await _(...n))})}))}if(typeof i.__node.repeat=="number"||typeof i.__node.recursive=="number"){let _=i.__operator;i.__setOperator(async(...n)=>{let s=i.__node.repeat?i.__node.repeat:i.__node.recursive,o,r=async(f,...a)=>{for(;f>0;){if(i.__node.delay||i.__node.frame){_(...a).then(async c=>{i.__node.recursive?await r(f,c):await r(f,...a)});break}else o=await _(...n);f--}};return await r(s,...n),o})}if(i.__node.loop&&typeof i.__node.loop=="number"){i.__node.looperSet=!0;let _=i.__operator;i.__setOperator((...s)=>{"looping"in i.__node||(i.__node.looping=!0),i.__node.looping&&(_(...s),setTimeout(()=>{i.__operator(...s)},i.__node.loop))}),i.__node.looping&&i.__operator();let n=s=>{s.__node.looping&&(s.__node.looping=!1)};i.__addOndisconnected(n)}}},S=(i,e,t)=>{if(i.__node.animate===!0||i.__animation){let _=i.__operator;i.__setOperator((...s)=>{"animating"in i.__node||(i.__node.animating=!0),i.__node.animating&&(typeof i.__animation=="function"?i.__animation(...s):_(...s),requestAnimationFrame(()=>{i.__operator(...s)}))}),(i.__node.animating||(!("animating"in i.__node)||i.__node.animating)&&i.__animation)&&setTimeout(()=>{requestAnimationFrame(i.__operator)},10);let n=s=>{s.__node.animating&&(s.__node.animating=!1)};i.__addOndisconnected(n)}},P=(i,e,t)=>{if(typeof i.__branch=="object"&&i.__operator&&!i.__branchApplied){let _=i.__operator;i.__branchApplied=!0,i.__operator=(...n)=>{let s=_(...n);for(let o in i.__branch){let r=()=>{typeof i.__branch[o].then=="function"?i.__branch[o].then(s):i.__branch[o].then instanceof h&&i.__branch[o].then.__operator?i.__branch[o].then.__operator(s):s=i.__branch[o].then};typeof i.__branch[o].if=="function"?i.__branch[o].if(s)==!0&&r():i.__branch[o].if===s&&r()}return s}}if(i.__listeners){for(let _ in i.__listeners)if(typeof i.__listeners[_]=="object"&&i.__listeners[_].branch&&!i.__listeners[_].branchApplied){let n=i.__listeners[_].callback;i.__listeners[_].branchApplied=!0,i.__listeners.callback=s=>{let o=()=>{typeof i.__listeners[_].branch.then=="function"?s=i.__listeners[_].branch.then(s):i.__listeners[_].branch.then instanceof h&&i.__listeners[_].branch.then.__operator?s=i.__listeners[_].branch.then.__operator(s):s=i.__listeners[_].branch.then};return typeof i.__listeners[_].branch.if=="function"?i.__listeners[_].branch.if(s)&&o():i.__listeners[_].branch.if===s&&o(),n(s)}}}},w=(i,e,t)=>{if(i.__listeners)for(let _ in i.__listeners)typeof i.__listeners[_]=="object"&&i.__listeners[_].oncreate&&i.__listeners[_].callback(i.__listeners[_].oncreate)},A=(i,e,t)=>{if(i.__listeners)for(let _ in i.__listeners)typeof i.__listeners[_]=="object"&&typeof i.__listeners[_].binding=="object"&&(i.__listeners.callback=i.__listeners.callback.bind(i.__listeners[_].binding))},q=(i,e,t)=>{if(i.__listeners){for(let _ in i.__listeners)if(typeof i.__listeners[_]=="object"&&typeof i.__listeners[_].transform=="function"&&!i.__listeners[_].transformApplied){let n=i.__listeners[_].callback;i.__listeners[_].transformApplied=!0,i.__listeners.callback=s=>(s=i.__listeners[_].transform(s),n(s))}}},L=(i,e,t)=>{i.post&&!i.__operator?i.__setOperator(i.post):!i.__operator&&typeof i.get=="function"&&i.__setOperator(i.get),!i.get&&i.__operator&&(i.get=i.__operator),i.aliases&&i.aliases.forEach(_=>{t.set(_,i);let n=s=>{t.__node.nodes.delete(_)};i.__addOndisconnected(n)}),typeof t.__node.roots?.[i.__node.tag]=="object"&&i.get&&(t.__node.roots[i.__node.tag].get=i.get)},C={backprop:j,loop:x,animate:S,branching:P,triggerListenerOncreate:w,bindListener:A,transformListenerResult:q,substitute__operator:L};})();
